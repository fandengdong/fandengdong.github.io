<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>LLM architecture on My work notes</title>
    <link>http://localhost:1313/llm/architecture/</link>
    <description>Recent content in LLM architecture on My work notes</description>
    <generator>Hugo -- 0.152.2</generator>
    <language>zh-CN</language>
    <lastBuildDate>Thu, 25 Dec 2025 00:00:00 +0000</lastBuildDate>
    <atom:link href="http://localhost:1313/llm/architecture/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>YaRN -  æ—‹è½¬ä½ç½®ç¼–ç æ‹“å±•</title>
      <link>http://localhost:1313/llm/architecture/yarn%E6%8E%A8%E7%90%86%E6%89%A9%E5%B1%95%E6%8A%80%E6%9C%AF/</link>
      <pubDate>Thu, 25 Dec 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/llm/architecture/yarn%E6%8E%A8%E7%90%86%E6%89%A9%E5%B1%95%E6%8A%80%E6%9C%AF/</guid>
      <description>&lt;p&gt;æ—‹è½¬ä½ç½®ç¼–ç ï¼ˆRoPE, Rotary Position Embeddingï¼‰æ˜¯ä¸€ç§åœ¨Transformeræ¨¡å‹ä¸­å¼•å…¥ç›¸å¯¹ä½ç½®ä¿¡æ¯ çš„æ–¹æ³•ï¼Œç”±è‹å‰‘æ—ç­‰Credoåœ¨2021å¹´æå‡ºã€‚ç›¸æ¯”ä¼ ç»Ÿçš„ç»å¯¹ä½ç½®ç¼–ç ï¼ˆå¦‚BERTä¸­çš„å¯å­¦ä¹ ä½ç½®åµŒå…¥æˆ–æ­£å¼¦ä½ç½®ç¼–ç ï¼‰ï¼ŒRoPEé€šè¿‡å°†ä½ç½®ä¿¡æ¯ä»¥æ—‹å˜æ¢çš„æ–¹å¼èå…¥æ³¨æ„åŠ›æœºåˆ¶ï¼Œä½¿å¾—æ¨¡å‹å¯ä»¥è‡ªç„¶åœ°æ„ŸçŸ¥ç›¸å¯¹ä½ç½®ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯åœ¨å®è·µä¸­ï¼Œæˆ‘ä»¬å¾€å¾€å‘ç°æœ‰äº›åº”ç”¨éœ€è¦å¤„ç†æ›´é•¿çš„åºåˆ—ï¼Œè€Œæ¨¡å‹åœ¨è®­ç»ƒæ—¶å€™çš„è¾“å…¥åºåˆ—é•¿åº¦å¾€å¾€æœ‰é™ï¼Œè¿™æ—¶RoPEå°±æ— æ³•æ»¡è¶³éœ€æ±‚ã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿå°†ä½ç½®ç¼–ç è¿›è¡Œå¤–æ¨çš„æŠ€æœ¯ã€‚YARNï¼ˆYet Another RoPE-based Attention Networkï¼‰æ˜¯ä¸€ç§ç”¨äºæ‰©å±•å¤§è¯­è¨€æ¨¡å‹ä¸Šä¸‹æ–‡é•¿åº¦çš„æŠ€æœ¯ï¼Œå®ƒæ˜¯åœ¨RoPEï¼ˆRotary Position Embeddingï¼‰åŸºç¡€ä¸Šè¿›è¡Œæ”¹è¿›çš„ï¼Œæ—¨åœ¨è®©æ¨¡å‹åœ¨è®­ç»ƒæ—¶ä½¿ç”¨è¾ƒçŸ­ä¸Šä¸‹æ–‡ï¼Œä½†åœ¨æ¨ç†æ—¶èƒ½æœ‰æ•ˆå¤„ç†è¿œè¶…è®­ç»ƒé•¿åº¦çš„è¾“å…¥åºåˆ—ã€‚&lt;/p&gt;
&lt;h2 id=&#34;èƒŒæ™¯ä¸ºä»€ä¹ˆéœ€è¦-yarn&#34;&gt;èƒŒæ™¯ï¼šä¸ºä»€ä¹ˆéœ€è¦ YARNï¼Ÿ&lt;/h2&gt;
&lt;h3 id=&#34;1-ä½ç½®ç¼–ç çš„å¤–æ¨é—®é¢˜&#34;&gt;1. ä½ç½®ç¼–ç çš„å¤–æ¨é—®é¢˜&lt;/h3&gt;
&lt;p&gt;å¤§å¤šæ•°å¤§è¯­è¨€æ¨¡å‹ï¼ˆå¦‚ LLaMAã€ChatGLM ç­‰ï¼‰ä½¿ç”¨ RoPEï¼ˆæ—‹è½¬ä½ç½®ç¼–ç ï¼‰ æ¥æ³¨å…¥ä½ç½®ä¿¡æ¯ã€‚RoPE çš„ä¼˜ç‚¹æ˜¯å…·æœ‰è‰¯å¥½çš„ç›¸å¯¹ä½ç½®å»ºæ¨¡èƒ½åŠ›ï¼Œä½†å…¶ç¼ºç‚¹æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è®­ç»ƒæ—¶æœ€å¤§ä¸Šä¸‹æ–‡é•¿åº¦æœ‰é™&lt;/strong&gt;ï¼ˆæ¯”å¦‚ 2048 æˆ– 4096ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›´æ¥æ¨ç†æ›´é•¿åºåˆ—æ—¶æ€§èƒ½æ€¥å‰§ä¸‹é™&lt;/strong&gt;ï¼ˆå› ä¸º RoPE ä¸­çš„é¢‘ç‡å‚æ•°æœªè¦†ç›–æ›´é•¿è·ç¦»ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;2-å·²æœ‰æ–¹æ³•çš„å±€é™&#34;&gt;2. å·²æœ‰æ–¹æ³•çš„å±€é™&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;NTK-aware scalingï¼ˆNeural Tangent Kernel ç¼©æ”¾ï¼‰&lt;/strong&gt;ï¼šé€šè¿‡ç¼©æ”¾ RoPE çš„ base é¢‘ç‡æ¥â€œæ‹‰ä¼¸â€ä½ç½®ç¼–ç ï¼Œä½†ä¼šç‰ºç‰²çŸ­è·ç¦»ç²¾åº¦ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;YaRN æå‡ºäº†ä¸€ç§æ›´ç²¾ç»†çš„æ’å€¼ + ç¼©æ”¾ç­–ç•¥&lt;/strong&gt;ï¼Œåœ¨ä¿æŒçŸ­ç¨‹ç²¾åº¦çš„åŒæ—¶æå‡é•¿ç¨‹æ³›åŒ–èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;yarn-çš„æ ¸å¿ƒæ€æƒ³&#34;&gt;YARN çš„æ ¸å¿ƒæ€æƒ³&lt;/h2&gt;
&lt;p&gt;YARN åœ¨ NTK-aware scaling åŸºç¡€ä¸Šå¼•å…¥äº†ä»¥ä¸‹å…³é”®æ”¹è¿›ï¼š&lt;/p&gt;
&lt;h3 id=&#34;1-å±€éƒ¨çª—å£å†…ä¿æŒåŸå§‹-ropeä¸ç¼©æ”¾&#34;&gt;1. å±€éƒ¨çª—å£å†…ä¿æŒåŸå§‹ RoPEï¼ˆä¸ç¼©æ”¾ï¼‰&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;å¯¹äºä½ç½® â‰¤ åŸå§‹è®­ç»ƒé•¿åº¦ï¼ˆå¦‚ 32Kï¼‰ï¼Œä½¿ç”¨åŸå§‹ RoPEï¼Œä¿ç•™é«˜ç²¾åº¦ã€‚
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;2-å¯¹è¶…å‡ºéƒ¨åˆ†ä½¿ç”¨ç¼©æ”¾åçš„-rope&#34;&gt;2. å¯¹è¶…å‡ºéƒ¨åˆ†ä½¿ç”¨ç¼©æ”¾åçš„ RoPE&lt;/h3&gt;
&lt;p&gt;å¯¹äºä½ç½® &amp;gt; è®­ç»ƒé•¿åº¦ï¼Œä½¿ç”¨ç»è¿‡ç¼©æ”¾çš„ base é¢‘ç‡ï¼ˆç±»ä¼¼ NTK æ–¹æ³•ï¼‰ã€‚&lt;/p&gt;</description>
    </item>
    <item>
      <title>MOE - æ··åˆä¸“å®¶æ¶æ„</title>
      <link>http://localhost:1313/llm/architecture/moe/%E6%B7%B7%E5%90%88%E4%B8%93%E5%AE%B6%E6%9E%B6%E6%9E%84moe/</link>
      <pubDate>Wed, 24 Dec 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/llm/architecture/moe/%E6%B7%B7%E5%90%88%E4%B8%93%E5%AE%B6%E6%9E%B6%E6%9E%84moe/</guid>
      <description>&lt;p&gt;æ··åˆä¸“å®¶ï¼ˆMixture of Experts, MoEï¼‰æ˜¯ä¸€ç§**æ¡ä»¶è®¡ç®—ï¼ˆconditional computationï¼‰**æ¶æ„ï¼Œæ—¨åœ¨åœ¨ä¸æ˜¾è‘—å¢åŠ è®¡ç®—æˆæœ¬çš„å‰æä¸‹æ‰©å±•æ¨¡å‹å®¹é‡ã€‚å®ƒå·²è¢«å¹¿æ³›åº”ç”¨äºç°ä»£å¤§è¯­è¨€æ¨¡å‹ï¼ˆå¦‚ Google çš„ GLaMã€Mixtralã€Qwen-MoEã€DeepSeek-MoE ç­‰ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;moe-çš„æ ¸å¿ƒæ€æƒ³&#34;&gt;MoE çš„æ ¸å¿ƒæ€æƒ³&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ğŸ¯ ç›®æ ‡ï¼š
&lt;ul&gt;
&lt;li&gt;æ‰©å¤§æ¨¡å‹å‚æ•°é‡ï¼ˆæå‡è¡¨è¾¾èƒ½åŠ›ï¼‰&lt;/li&gt;
&lt;li&gt;ä¿æŒæ¯æ¬¡å‰å‘è®¡ç®—çš„ FLOPs åŸºæœ¬ä¸å˜ï¼ˆé«˜æ•ˆæ¨ç†ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ğŸ”‘ å…³é”®æœºåˆ¶ï¼š
&lt;ul&gt;
&lt;li&gt;æ¨¡å‹ç”±å¤šä¸ªâ€œä¸“å®¶â€ï¼ˆExpertsï¼‰ç»„æˆï¼Œæ¯ä¸ªä¸“å®¶æ˜¯ä¸€ä¸ªå­ç½‘ç»œï¼ˆå¦‚ FFNï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å¼•å…¥ä¸€ä¸ªé—¨æ§ç½‘ç»œï¼ˆGating Networkï¼‰ï¼Œæ ¹æ®è¾“å…¥åŠ¨æ€å†³å®šæ¿€æ´»å“ªå‡ ä¸ªä¸“å®¶ã€‚&lt;/li&gt;
&lt;li&gt;é€šå¸¸åªæ¿€æ´» Top-K ä¸ªä¸“å®¶ï¼ˆå¦‚ K=1 æˆ– K=2ï¼‰ï¼Œå…¶ä½™ä¸“å®¶ä¸å‚ä¸è®¡ç®—ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;âœ… è¿™æ ·ï¼šæ€»å‚æ•°é‡ = æ‰€æœ‰ä¸“å®¶å‚æ•°ä¹‹å’Œï¼ˆå¾ˆå¤§ï¼‰ï¼Œä½†æ¯ token è®¡ç®—é‡ â‰ˆ K ä¸ªä¸“å®¶ï¼ˆå¾ˆå°ï¼‰ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;moeç»™transformeræ¶æ„å¸¦æ¥çš„æ”¹å˜&#34;&gt;MoEç»™Transformeræ¶æ„å¸¦æ¥çš„æ”¹å˜&lt;/h2&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬ä» Transformer æ¶æ„å‡ºå‘ï¼Œæ·±å…¥è®²è§£ MoEï¼ˆMixture of Expertsï¼‰çš„æ•°å­¦å½¢å¼ã€é—¨æ§æœºåˆ¶æ¥æºã€ä¸“å®¶æ¨¡å—åœ¨ Transformer ä¸­çš„å…·ä½“ä½ç½®ä¸ä½œç”¨&lt;/p&gt;
&lt;h3 id=&#34;moe-åœ¨-transformer-ä¸­çš„ä½ç½®&#34;&gt;MoE åœ¨ Transformer ä¸­çš„ä½ç½®&lt;/h3&gt;
&lt;p&gt;åœ¨æ ‡å‡† Transformer ä¸­ï¼Œæ¯ä¸ª Transformer å±‚åŒ…å«ä¸¤ä¸ªæ ¸å¿ƒå­æ¨¡å—ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¤šå¤´æ³¨æ„åŠ›ï¼ˆMulti-Head Attention, MHAï¼‰&lt;/li&gt;
&lt;li&gt;å‰é¦ˆç½‘ç»œï¼ˆFeed-Forward Network, FFNï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;âœ… MoE é€šå¸¸åªæ›¿æ¢ FFN éƒ¨åˆ†ï¼Œè€Œä¿ç•™ MHA ä¸å˜ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ª MoE Transformer å±‚çš„ç»“æ„ä¸ºï¼š&lt;/p&gt;</description>
    </item>
    <item>
      <title>RoPE - æ—‹è½¬ä½ç½®ç¼–ç è§£è¯»</title>
      <link>http://localhost:1313/llm/architecture/rope/</link>
      <pubDate>Fri, 19 Dec 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/llm/architecture/rope/</guid>
      <description>&lt;p&gt;æ—‹è½¬ä½ç½®ç¼–ç ï¼ˆRoPE, Rotary Position Embeddingï¼‰æ˜¯ä¸€ç§åœ¨Transformeræ¨¡å‹ä¸­å¼•å…¥ç›¸å¯¹ä½ç½®ä¿¡æ¯çš„æ–¹æ³•ï¼Œç”±è‹å‰‘æ—ç­‰äººåœ¨2021å¹´æå‡ºã€‚ç›¸æ¯”ä¼ ç»Ÿçš„ç»å¯¹ä½ç½®ç¼–ç ï¼ˆå¦‚BERTä¸­çš„å¯å­¦ä¹ ä½ç½®åµŒå…¥æˆ–æ­£å¼¦ä½ç½®ç¼–ç ï¼‰ï¼ŒRoPEé€šè¿‡å°†ä½ç½®ä¿¡æ¯ä»¥æ—‹è½¬å˜æ¢çš„æ–¹å¼èå…¥æ³¨æ„åŠ›æœºåˆ¶ï¼Œä½¿å¾—æ¨¡å‹å¤©ç„¶å…·å¤‡å¯¹ç›¸å¯¹ä½ç½®çš„æ„ŸçŸ¥èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å›é¡¾åŸå§‹ä½ç½®ç¼–ç &#34;&gt;å›é¡¾åŸå§‹ä½ç½®ç¼–ç &lt;/h2&gt;
&lt;p&gt;åœ¨Transformeræ¨¡å‹ä¸­ï¼Œä½ç½®ç¼–ç ï¼ˆPosition Encodingï¼‰ç”¨äºå°†è¾“å…¥åºåˆ—ä¸­çš„æ¯ä¸ªä½ç½®æ˜ å°„ä¸ºå‘é‡ï¼Œä»¥è¡¨ç¤ºå…¶ç›¸å¯¹ä½ç½®ä¿¡æ¯ã€‚åŸå§‹ä½ç½®ç¼–ç çš„å®ç°æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œå¦‚å¯å­¦ä¹ ä½ç½®åµŒå…¥ï¼ˆLearnable Position Embeddingï¼‰æˆ–æ­£å¼¦ä½ç½®ç¼–ç ï¼ˆSinusoidal Position Encodingï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å‡è®¾æˆ‘ä»¬çš„è¯æ±‡è¡¨å¤§å°ä¸º&lt;code&gt;[vocab_size, embedding_dim]&lt;/code&gt;ï¼Œè¾“å…¥å¥å­çš„tokené•¿åº¦ä¸º&lt;code&gt;seq_len&lt;/code&gt;ï¼Œæ¯ä¸ªtokenä¼šè¢«è½¬æ¢æˆä¸€ä¸ªvectorå‘é‡ï¼Œç»´åº¦ä¸º&lt;code&gt;[embedding_dim]&lt;/code&gt;ï¼Œåˆ™æ•´ä¸ªè¾“å…¥å¥å­çš„shapeä¸º&lt;code&gt;[ seq_len, embedding_dim]&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œä¸ºäº†è®©æ¨¡å‹ç†è§£åºåˆ—çš„é¡ºåºï¼Œè¿˜éœ€è¦åŠ å…¥ä½ç½®ç¼–ç (Positional Encoding)ã€‚è¿™å°±æ˜¯è‘—åçš„å…¬å¼ï¼š&lt;/p&gt;
&lt;p&gt;$$
PE_{(pos,2i)} = \sin\left(\frac{pos}{10000^{2i/d_{model}}}\right)
$$&lt;/p&gt;
&lt;p&gt;$$
PE_{(pos,2i+1)} = \cos\left(\frac{pos}{10000^{2i/d_{model}}}\right)
$$&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;pos&lt;/code&gt;æ˜¯ä½ç½®ç´¢å¼•ï¼Œå³tokenåœ¨åºåˆ—ä¸­çš„ä½ç½®ï¼Œä»0å¼€å§‹ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;i&lt;/code&gt;æ˜¯ç»´åº¦ç´¢å¼•ï¼Œä»0å¼€å§‹åˆ°$(d_{model}-1)/2$ç»“æŸï¼Œè¡¨ç¤ºè¯åµŒå…¥çš„ç»´åº¦ï¼›&lt;/li&gt;
&lt;li&gt;$d_{model}$æ˜¯è¯åµŒå…¥ï¼ˆword embeddingï¼‰çš„ç»´åº¦&lt;code&gt;embedding_dim&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è§‚å¯Ÿè¾“å…¥å¥å­çš„shape: &lt;code&gt;[seq_len, embedding_dim]&lt;/code&gt;ï¼Œä½ç½®ç¼–ç çš„æ—¶å€™ï¼Œ&lt;code&gt;pos&lt;/code&gt;å¯¹åº”çš„æ˜¯tokenåœ¨&lt;code&gt;seq_len&lt;/code&gt;ç»´åº¦çš„ä½ç½®ï¼Œè€Œç»´åº¦ç´¢å¼•&lt;code&gt;i&lt;/code&gt;å¯¹åº”è¯åµŒå…¥&lt;code&gt;embedding_dim&lt;/code&gt;çš„ç»´åº¦ã€‚&lt;/p&gt;
&lt;p&gt;pytorchä»£ç å®ç°:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;PositionalEncoding&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;nn&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Module&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;fm&#34;&gt;__init__&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d_model&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;max_len&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nb&#34;&gt;super&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;fm&#34;&gt;__init__&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;pe&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;torch&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;zeros&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;max_len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d_model&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;position&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;torch&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;arange&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;max_len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;unsqueeze&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;float&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;div_term&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;torch&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;exp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;torch&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;arange&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d_model&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;float&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;torch&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;torch&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tensor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;10000.0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d_model&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;pe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;torch&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;position&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;div_term&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;pe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;torch&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cos&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;position&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;div_term&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;register_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;pe&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pe&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;unsqueeze&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;forward&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;rope-çš„æ ¸å¿ƒæ€æƒ³&#34;&gt;RoPE çš„æ ¸å¿ƒæ€æƒ³&lt;/h2&gt;
&lt;h3 id=&#34;ç›¸å¯¹ä½ç½®-vs-ç»å¯¹ä½ç½®&#34;&gt;ç›¸å¯¹ä½ç½® vs ç»å¯¹ä½ç½®&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ä¼ ç»ŸTransformerä¸­ï¼Œä½ç½®ç¼–ç æ˜¯åŠ åˆ°è¯åµŒå…¥ä¸Šçš„ï¼ˆå¦‚ x + pos_embï¼‰ï¼Œè¿™ç§æ–¹å¼åªä¿ç•™äº†ç»å¯¹ä½ç½®ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;è€Œ RoPE åˆ™é€šè¿‡å°†æŸ¥è¯¢ï¼ˆQï¼‰å’Œé”®ï¼ˆKï¼‰å‘é‡è¿›è¡Œæ—‹è½¬å˜æ¢ï¼Œä½¿å¾—æ³¨æ„åŠ›åˆ†æ•°è‡ªç„¶åŒ…å«ä¸¤ä¸ª token ä¹‹é—´çš„ç›¸å¯¹è·ç¦»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ—‹è½¬æ“ä½œ&#34;&gt;æ—‹è½¬æ“ä½œ&lt;/h3&gt;
&lt;p&gt;å¯¹äºç»´åº¦ä¸º d çš„å‘é‡ï¼ŒRoPE å°†å…¶åˆ†æˆè‹¥å¹²äºŒç»´å­ç©ºé—´ï¼ˆé€šå¸¸æ˜¯ç›¸é‚»ä¸¤ä¸ªç»´åº¦ä¸€ç»„ï¼‰ï¼Œæ¯ç»„åº”ç”¨ä¸€ä¸ªäºŒç»´æ—‹è½¬çŸ©é˜µï¼š&lt;/p&gt;</description>
    </item>
    <item>
      <title>ä¸€åˆ‡çš„å¼€å§‹ - Transformeræ¶æ„</title>
      <link>http://localhost:1313/llm/architecture/transformer/</link>
      <pubDate>Fri, 19 Dec 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/llm/architecture/transformer/</guid>
      <description>&lt;h2 id=&#34;transformerçš„è¯ç”ŸèƒŒæ™¯&#34;&gt;Transformerçš„è¯ç”ŸèƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;åœ¨æ·±åº¦å­¦ä¹ çš„ä¸–ç•Œé‡Œï¼Œåºåˆ—å»ºæ¨¡ä¸€ç›´æ˜¯ä¸ªè€å¤§éš¾é—®é¢˜ã€‚ä¼ ç»Ÿçš„å¾ªç¯ç¥ç»ç½‘ç»œ(RNN)è™½ç„¶èƒ½å¤Ÿå¤„ç†åºåˆ—æ•°æ®ï¼Œä½†åœ¨å¤„ç†é•¿åºåˆ—æ—¶å­˜åœ¨æ¢¯åº¦æ¶ˆå¤±å’Œè®¡ç®—æ•ˆç‡ä½ä¸‹çš„é—®é¢˜ã€‚è€Œå·ç§¯ç¥ç»ç½‘ç»œ(CNN)è™½ç„¶å¹¶è¡ŒåŒ–ç¨‹åº¦é«˜ï¼Œä½†åœ¨æ•æ‰é•¿è·ç¦»ä¾èµ–å…³ç³»æ–¹é¢åŠ›ä¸ä»å¿ƒã€‚&lt;/p&gt;
&lt;p&gt;å°±åœ¨è¿™ä¸ªå…³é”®æ—¶åˆ»ï¼ŒGoogleçš„å¤§ç¥ä»¬åœ¨2017å¹´æ‰”å‡ºäº†ä¸€ä¸ª&amp;quot;æ ¸å¼¹çº§&amp;quot;çš„è§£å†³æ–¹æ¡ˆâ€”â€”ã€ŠAttention Is All You Needã€‹ã€‚è¿™ç¯‡è®ºæ–‡å½»åº•é¢ è¦†äº†äººä»¬å¯¹åºåˆ—å»ºæ¨¡çš„è®¤çŸ¥ï¼Œæå‡ºäº†å®Œå…¨åŸºäºæ³¨æ„åŠ›æœºåˆ¶çš„Transformeræ¶æ„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt=&#34;Transformer Architecture&#34; loading=&#34;lazy&#34; src=&#34;http://localhost:1313/llm/architecture/transformer/transformer.png&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;ç¿»è¯‘ä»»åŠ¡transformerçš„è¯•éªŒåœº&#34;&gt;ç¿»è¯‘ä»»åŠ¡ï¼šTransformerçš„è¯•éªŒåœº&lt;/h2&gt;
&lt;p&gt;Transformeræœ€åˆæ˜¯ä¸ºäº†æœºå™¨ç¿»è¯‘ä»»åŠ¡è€Œè®¾è®¡çš„ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ è¦æŠŠä¸€å¥ä¸­æ–‡ç¿»è¯‘æˆè‹±æ–‡ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¸­æ–‡è¾“å…¥&lt;/strong&gt;: &amp;ldquo;æˆ‘å–œæ¬¢å­¦ä¹ äººå·¥æ™ºèƒ½&amp;rdquo;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è‹±æ–‡è¾“å‡º&lt;/strong&gt;: &amp;ldquo;I like studying artificial intelligence&amp;rdquo;&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ¨¡å‹éœ€è¦ç†è§£æ¯ä¸ªè¯çš„å«ä¹‰ï¼Œå¹¶æ‰¾åˆ°å®ƒä»¬ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚ä¼ ç»Ÿçš„Seq2Seqæ¨¡å‹ä¾èµ–RNNæ¥ç¼–ç è¾“å…¥åºåˆ—ï¼Œä½†æ•ˆæœæœ‰é™ã€‚è€ŒTransformeré€šè¿‡è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼Œèƒ½å¤ŸåŒæ—¶å…³æ³¨è¾“å…¥åºåˆ—ä¸­çš„æ‰€æœ‰ä½ç½®ï¼Œå¤§å¤§æå‡äº†ç¿»è¯‘è´¨é‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;transformerçš„åŸºæœ¬è¾“å…¥è¾“å‡º&#34;&gt;Transformerçš„åŸºæœ¬è¾“å…¥è¾“å‡º&lt;/h2&gt;
&lt;h3 id=&#34;è¾“å…¥çš„ç§˜å¯†&#34;&gt;è¾“å…¥çš„ç§˜å¯†&lt;/h3&gt;
&lt;p&gt;Transformerçš„è¾“å…¥å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ªä¸ªtokenï¼ˆå¯ä»¥æ˜¯å•è¯ã€å­è¯æˆ–è€…å­—ç¬¦ï¼‰ã€‚å‡è®¾æˆ‘ä»¬çš„è¯æ±‡è¡¨å¤§å°ä¸º&lt;code&gt;[vocab_size, embedding_dim]&lt;/code&gt;ï¼Œè¾“å…¥å¥å­çš„tokené•¿åº¦ä¸º&lt;code&gt;seq_len&lt;/code&gt;ï¼Œæ¯ä¸ªtokenä¼šè¢«è½¬æ¢æˆä¸€ä¸ªvectorå‘é‡ï¼Œç»´åº¦ä¸º&lt;code&gt;[embedding_dim]&lt;/code&gt;ï¼Œåˆ™æ•´ä¸ªè¾“å…¥å¥å­çš„shapeä¸º&lt;code&gt;[ seq_len, embedding_dim]&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œä¸ºäº†è®©æ¨¡å‹ç†è§£åºåˆ—çš„é¡ºåºï¼Œè¿˜éœ€è¦åŠ å…¥ä½ç½®ç¼–ç (Positional Encoding)ã€‚è¿™å°±æ˜¯è‘—åçš„å…¬å¼ï¼š&lt;/p&gt;
&lt;p&gt;$$
PE_{(pos,2i)} = \sin\left(\frac{pos}{10000^{2i/d_{model}}}\right)
$$&lt;/p&gt;
&lt;p&gt;$$
PE_{(pos,2i+1)} = \cos\left(\frac{pos}{10000^{2i/d_{model}}}\right)
$$&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;pos&lt;/code&gt;æ˜¯ä½ç½®ç´¢å¼•ï¼Œå³tokenåœ¨åºåˆ—ä¸­çš„ä½ç½®ï¼Œä»0å¼€å§‹ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;i&lt;/code&gt;æ˜¯ç»´åº¦ç´¢å¼•ï¼Œä»0å¼€å§‹åˆ°$d_{model}-1$ç»“æŸï¼Œè¡¨ç¤ºè¯åµŒå…¥çš„ç»´åº¦ï¼›&lt;/li&gt;
&lt;li&gt;$d_{model}$æ˜¯è¯åµŒå…¥ï¼ˆword embeddingï¼‰çš„ç»´åº¦&lt;code&gt;embedding_dim&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è§‚å¯Ÿè¾“å…¥å¥å­çš„shape: &lt;code&gt;[seq_len, embedding_dim]&lt;/code&gt;ï¼Œä½ç½®ç¼–ç çš„æ—¶å€™ï¼Œ&lt;code&gt;pos&lt;/code&gt;å¯¹åº”çš„æ˜¯tokenåœ¨&lt;code&gt;seq_len&lt;/code&gt;ç»´åº¦çš„ä½ç½®ï¼Œè€Œç»´åº¦ç´¢å¼•&lt;code&gt;i&lt;/code&gt;å¯¹åº”è¯åµŒå…¥&lt;code&gt;embedding_dim&lt;/code&gt;çš„ç»´åº¦ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è¾“å‡ºçš„é­…åŠ›&#34;&gt;è¾“å‡ºçš„é­…åŠ›&lt;/h3&gt;
&lt;p&gt;Transformerçš„è¾“å‡ºåŒæ ·æ˜¯ä¸€ç³»åˆ—tokenï¼Œä½†å®ƒè¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šä¹‹å¤„â€”â€”å®ƒæ˜¯ä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒã€‚å¯¹äºæ¯ä¸ªæ—¶é—´æ­¥ï¼Œæ¨¡å‹ä¼šè¾“å‡ºè¯æ±‡è¡¨ä¸­æ¯ä¸ªè¯çš„æ¦‚ç‡ï¼Œç„¶åé€šè¿‡è´ªå©ªæœç´¢æˆ–æŸæœç´¢æ¥é€‰æ‹©æœ€åˆé€‚çš„è¯ã€‚è¿™äº›æœç´¢ç®—æ³•æ„æˆäº†æ¨ç†æ—¶æ‰©å±•ç®—æ³•çš„åŸºç¡€ã€‚&lt;/p&gt;
&lt;p&gt;è¡¥å……è´ªå©ªæœç´¢å’ŒæŸæœç´¢çš„ç®—æ³•ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è´ªå©ªæœç´¢æ˜¯ä¸€ç§ç®€å•ç›´æ¥çš„è§£ç ç­–ç•¥ã€‚åœ¨æ¯ä¸ªæ—¶é—´æ­¥ï¼Œå®ƒæ€»æ˜¯é€‰æ‹©å…·æœ‰æœ€é«˜æ¦‚ç‡çš„tokenä½œä¸ºä¸‹ä¸€ä¸ªè¾“å‡ºï¼Œä¸è€ƒè™‘åç»­å¯èƒ½çš„å½±å“ã€‚ä¼˜ç‚¹æ˜¯è®¡ç®—ç®€å•ï¼Œé€Ÿåº¦å¿«ï¼Œå†…å­˜å ç”¨å°‘ï¼›ç¼ºç‚¹åˆ™æ˜¯å®¹æ˜“é™·å…¥å±€éƒ¨æœ€ä¼˜ï¼Œç”Ÿæˆç»“æœç¼ºä¹å¤šæ ·æ€§ã€‚&lt;/li&gt;
&lt;li&gt;æŸæœç´¢æ˜¯å¯¹è´ªå©ªæœç´¢çš„æ”¹è¿›ï¼Œåœ¨æ¯ä¸ªæ—¶é—´æ­¥ä¿ç•™beam_widthä¸ªæœ€æœ‰å¸Œæœ›çš„å€™é€‰åºåˆ—ï¼Œè€Œä¸æ˜¯åªä¿ç•™ä¸€ä¸ªã€‚ç›¸æ¯”è´ªå©ªæœç´¢èƒ½æ‰¾åˆ°æ›´ä¼˜çš„åºåˆ—ï¼Œåœ¨åˆç†çš„æ—¶é—´å†…æ¢ç´¢å¤šä¸ªå¯èƒ½æ€§ï¼›ç¼ºç‚¹åˆ™æ˜¯è®¡ç®—å¤æ‚åº¦è¾ƒé«˜ï¼Œéœ€è¦è°ƒæ•´beam_widthå‚æ•°ï¼Œä»å¯èƒ½é”™è¿‡å…¨å±€æœ€ä¼˜è§£ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;æ ¸å¿ƒæ¨¡å—encoderå’Œdecoder&#34;&gt;æ ¸å¿ƒæ¨¡å—ï¼šEncoderå’ŒDecoder&lt;/h2&gt;
&lt;p&gt;Transformerçš„æ ¸å¿ƒç”±ä¸¤å¤§éƒ¨åˆ†ç»„æˆï¼š&lt;code&gt;Encoder&lt;/code&gt;å’Œ&lt;code&gt;Decoder&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;encoderä¿¡æ¯çš„åŠ å·¥å‚&#34;&gt;Encoderï¼šä¿¡æ¯çš„åŠ å·¥å‚&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;Encoder&lt;/code&gt;è´Ÿè´£å°†è¾“å…¥åºåˆ—è½¬æ¢æˆä¸€ç³»åˆ—éšè—è¡¨ç¤ºã€‚å®ƒç”±Nä¸ªç›¸åŒçš„å±‚å †å è€Œæˆï¼Œæ¯ä¸€å±‚éƒ½åŒ…å«ä¸¤ä¸ªå­å±‚ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¤šå¤´è‡ªæ³¨æ„åŠ›æœºåˆ¶(Multi-Head Self-Attention)&lt;/li&gt;
&lt;li&gt;ä½ç½®å…¨è¿æ¥å‰é¦ˆç½‘ç»œ(Position-wise Feed-Forward Networks)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ¯å±‚éƒ½æœ‰æ®‹å·®è¿æ¥å’Œå±‚å½’ä¸€åŒ–ï¼Œè¿™ä½¿å¾—æ·±å±‚ç½‘ç»œä¹Ÿèƒ½ç¨³å®šè®­ç»ƒã€‚&lt;/p&gt;
&lt;h3 id=&#34;decoderåˆ›ä½œçš„è‰ºæœ¯å®¶&#34;&gt;Decoderï¼šåˆ›ä½œçš„è‰ºæœ¯å®¶&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;Decoder&lt;/code&gt;åˆ™è´Ÿè´£æ ¹æ®&lt;code&gt;Encoder&lt;/code&gt;çš„è¾“å‡ºå’Œä¹‹å‰ç”Ÿæˆçš„tokenæ¥é¢„æµ‹ä¸‹ä¸€ä¸ªtokenã€‚å®ƒçš„ç»“æ„æ¯”&lt;code&gt;Encoder&lt;/code&gt;ç¨å¤æ‚ä¸€äº›ï¼ŒåŒ…å«ä¸‰ä¸ªå­å±‚ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ©ç å¤šå¤´è‡ªæ³¨æ„åŠ›æœºåˆ¶(Masked Multi-Head Self-Attention)&lt;/li&gt;
&lt;li&gt;å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶(Multi-Head Attention)&lt;/li&gt;
&lt;li&gt;ä½ç½®å…¨è¿æ¥å‰é¦ˆç½‘ç»œ(Position-wise Feed-Forward Networks)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å…¶ä¸­æ©ç æœºåˆ¶ç¡®ä¿åœ¨ç”Ÿæˆå½“å‰ä½ç½®çš„è¾“å‡ºæ—¶ï¼Œåªèƒ½çœ‹åˆ°ä¹‹å‰çš„ä½ç½®ï¼Œä¸èƒ½&amp;quot;å·çœ‹&amp;quot;æœªæ¥çš„ä¿¡æ¯ã€‚&lt;/p&gt;</description>
    </item>
    <item>
      <title>ç»¼è¿° - Transformeræ¶æ„çš„æ¼”è¿›</title>
      <link>http://localhost:1313/llm/architecture/transformer%E6%9E%B6%E6%9E%84%E7%9A%84%E6%BC%94%E8%BF%9B/</link>
      <pubDate>Fri, 19 Dec 2025 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/llm/architecture/transformer%E6%9E%B6%E6%9E%84%E7%9A%84%E6%BC%94%E8%BF%9B/</guid>
      <description>&lt;h2 id=&#34;transformeræ¶æ„æ¼”è¿›ä»è‡ªæ³¨æ„åŠ›åˆ°é•¿åºåˆ—ä¸å¤šæ¨¡æ€çš„é©å‘½æ€§çªç ´&#34;&gt;Transformeræ¶æ„æ¼”è¿›ï¼šä»è‡ªæ³¨æ„åŠ›åˆ°é•¿åºåˆ—ä¸å¤šæ¨¡æ€çš„é©å‘½æ€§çªç ´&lt;/h2&gt;
&lt;p&gt;Transformerè‡ª2017å¹´æå‡ºä»¥æ¥ï¼Œå·²æˆä¸ºæ·±åº¦å­¦ä¹ é¢†åŸŸçš„åŸºçŸ³æ¶æ„ï¼Œå…¶æ¼”è¿›å†ç¨‹åæ˜ äº†AIç ”ç©¶è€…å¯¹è®¡ç®—æ•ˆç‡ã€é•¿åºåˆ—å¤„ç†èƒ½åŠ›å’Œè·¨æ¨¡æ€åº”ç”¨çš„ä¸æ‡ˆè¿½æ±‚ã€‚&lt;strong&gt;ä»æœ€åˆçš„O(nÂ²)è®¡ç®—å¤æ‚åº¦åˆ°å¦‚ä»Šçš„O(n)çº¿æ€§å¤æ‚åº¦ï¼Œä»å•æ¨¡æ€æ–‡æœ¬å¤„ç†åˆ°åŸç”Ÿå¤šæ¨¡æ€æ¶æ„ï¼ŒTransformerçš„æ¼”è¿›ä¸ä»…è§£å†³äº†è‡ªèº«å±€é™ï¼Œæ›´æ¨åŠ¨äº†å¤§è¯­è¨€æ¨¡å‹ã€è§†è§‰æ¨¡å‹å’Œå¤šæ¨¡æ€ç³»ç»Ÿçš„é©å‘½æ€§å‘å±•&lt;/strong&gt;ã€‚è¿™äº›æ¼”è¿›ä¸»è¦ä½“ç°åœ¨æ³¨æ„åŠ›æœºåˆ¶åˆ›æ–°ã€ä½ç½®ç¼–ç æ”¹è¿›ã€æ¨¡å‹æ¶æ„å˜ä½“ä¸æ‰©å±•ã€è®­ç»ƒæ¨ç†æ•ˆç‡ä¼˜åŒ–å››å¤§æ–¹å‘ï¼Œå…±åŒæ„å»ºäº†ç°ä»£AIç³»ç»Ÿçš„è®¡ç®—åŸºç¡€ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸€æ³¨æ„åŠ›æœºåˆ¶çš„æ¼”è¿›ä»å…¨å±€åˆ°ç¨€ç–å†åˆ°çŠ¶æ€ç©ºé—´æ¨¡å‹&#34;&gt;ä¸€ã€æ³¨æ„åŠ›æœºåˆ¶çš„æ¼”è¿›ï¼šä»å…¨å±€åˆ°ç¨€ç–å†åˆ°çŠ¶æ€ç©ºé—´æ¨¡å‹&lt;/h3&gt;
&lt;p&gt;TransformeråŸå§‹æ¶æ„çš„æ ¸å¿ƒæ˜¯è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼Œå®ƒé€šè¿‡è®¡ç®—æŸ¥è¯¢(Q)ã€é”®(K)å’Œå€¼(V)ä¹‹é—´çš„ç›¸ä¼¼åº¦æ¥æ•æ‰åºåˆ—å†…éƒ¨çš„é•¿è·ç¦»ä¾èµ–å…³ç³»  ã€‚æ ‡å‡†è‡ªæ³¨æ„åŠ›çš„è®¡ç®—å…¬å¼ä¸ºï¼š&lt;/p&gt;
&lt;p&gt;$$
\text{Attention}(Q,K,V) = \text{softmax}\left( \frac{QK^\top}{\sqrt{d_k}} \right)V
$$&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ï¼Œ$Qâˆˆâ„^{nÃ—d_k}$ï¼Œ$Kâˆˆâ„^{nÃ—d_k}$ï¼Œ$Vâˆˆâ„^{nÃ—d_v}$ï¼Œd_kæ˜¯é”®å‘é‡çš„ç»´åº¦ã€‚è¿™ä¸€æœºåˆ¶è™½ç„¶å¼ºå¤§ï¼Œä½†è®¡ç®—å¤æ‚åº¦ä¸ºO(nÂ²)ï¼Œéšç€åºåˆ—é•¿åº¦nçš„å¢åŠ å‘ˆå¹³æ–¹å¢é•¿ï¼Œä¸¥é‡é™åˆ¶äº†å¤„ç†é•¿æ–‡æœ¬çš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºè§£å†³è¿™ä¸€ç“¶é¢ˆï¼Œç ”ç©¶è€…ä»å¤šä¸ªè§’åº¦å¯¹æ³¨æ„åŠ›æœºåˆ¶è¿›è¡Œäº†åˆ›æ–°ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1. ç¨€ç–æ³¨æ„åŠ›æœºåˆ¶&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç¨€ç–æ³¨æ„åŠ›é€šè¿‡é™åˆ¶æ¯ä¸ªtokenåªèƒ½å…³æ³¨åºåˆ—ä¸­çš„å±€éƒ¨åŒºåŸŸï¼Œå°†è®¡ç®—å¤æ‚åº¦ä»O(nÂ²)é™è‡³O(n)ã€‚ä¸»è¦ä»£è¡¨åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Longformer&lt;/strong&gt;ï¼šé‡‡ç”¨æ»‘åŠ¨çª—å£æ³¨æ„åŠ›æœºåˆ¶ï¼Œæ¯ä¸ªtokenä»…å…³æ³¨å…¶å‘¨å›´å›ºå®šçª—å£å†…çš„tokenï¼ŒåŒæ—¶ä¿ç•™å°‘æ•°å…¨å±€tokenä»¥ç»´æŒä¸Šä¸‹æ–‡è¿è´¯æ€§  ã€‚å…¶çª—å£æ³¨æ„åŠ›å…¬å¼ä¸ºï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;$$
\text{WindowAttention}(Q,K,V) = \text{softmax}\left( \frac{QK^\top}{\sqrt{d_k}} \right)V_{\text{window}}
$$&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ï¼ŒV_windowæ˜¯çª—å£å†…å€¼å‘é‡çš„å­é›†ï¼Œçª—å£å¤§å°é€šå¸¸ä¸º512æˆ–1024ä¸ªtoken  ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;BigBird&lt;/strong&gt;ï¼šç»“åˆä¸‰ç§æ³¨æ„åŠ›æ¨¡å¼â€”â€”éšæœºæ³¨æ„åŠ›ï¼ˆé€šè¿‡ErdÅ‘s-RÃ©nyiå›¾é‡‡æ ·ï¼‰ã€æ»‘åŠ¨çª—å£æ³¨æ„åŠ›å’Œå…¨å±€æ³¨æ„åŠ›  ã€‚éšæœºæ³¨æ„åŠ›ä½¿æ¨¡å‹èƒ½å¤Ÿæ•æ‰é•¿è·ç¦»ä¾èµ–ï¼ŒåŒæ—¶ä¿æŒO(n)çš„çº¿æ€§å¤æ‚åº¦ã€‚å…¶éšæœºæ³¨æ„åŠ›çŸ©é˜µå¯ä»¥è¡¨ç¤ºä¸ºï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;$$
\text{RandomAttention}(Q,K,V) = \text{softmax}\left( \frac{QW_{\text{random}}K^\top}{\sqrt{d_k}} \right)V_{\text{random}}
$$&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ï¼Œ$W_{random}$æ˜¯éšæœºæ©ç çŸ©é˜µï¼Œ$V_{random}$æ˜¯éšæœºé‡‡æ ·å€¼å‘é‡çš„å­é›†  ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å±€éƒ¨å¢å¼ºMambaï¼ˆLEVMï¼‰&lt;/strong&gt;ï¼šåœ¨Mambaæ¶æ„ä¸­ï¼Œé€šè¿‡åŠ¨æ€é€‰æ‹©æ€§å¤„ç†ï¼Œå¯¹é‡è¦ä¿¡æ¯ä¿ç•™å®Œæ•´çŠ¶æ€ï¼Œå¯¹ä¸é‡è¦ä¿¡æ¯è¿›è¡Œå‹ç¼©ï¼Œå®ç°O(n)è®¡ç®—å¤æ‚åº¦å’ŒO(1)æ˜¾å­˜å ç”¨  ã€‚å…¶æ ¸å¿ƒçŠ¶æ€æ–¹ç¨‹ä¸ºï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;$$
h_t = \overline{A}h_{t-1} + \overline{B}x_t
$$&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ï¼Œ$\overline{A}$å’Œ$\overline{B}$æ˜¯åŠ¨æ€ç”Ÿæˆçš„å‚æ•°çŸ©é˜µï¼Œå…è®¸æ¨¡å‹æ ¹æ®è¾“å…¥é€‰æ‹©æ€§åœ°ä¿ç•™ä¿¡æ¯  ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2. çº¿æ€§æ³¨æ„åŠ›æœºåˆ¶&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;çº¿æ€§æ³¨æ„åŠ›é€šè¿‡æ•°å­¦è¿‘ä¼¼æŠ€æœ¯ï¼Œå°†æ³¨æ„åŠ›è®¡ç®—çš„å¤æ‚åº¦é™è‡³O(n)ï¼ŒåŒæ—¶ä¿æŒæ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ã€‚ä¸»è¦ä»£è¡¨åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Performer&lt;/strong&gt;ï¼šé‡‡ç”¨æ ¸å‡½æ•°è¿‘ä¼¼æ–¹æ³•ï¼Œå°†æ ‡å‡†æ³¨æ„åŠ›å…¬å¼ä¸­çš„softmax(QKáµ€)æ›¿æ¢ä¸ºæ ¸å‡½æ•°K(Q,K)ï¼Œä½¿å¾—è®¡ç®—å¯ä»¥åˆ†è§£ä¸ºO(n)çš„çº¿æ€§æ“ä½œ  ã€‚å…¶æ ¸å¿ƒå…¬å¼ä¸ºï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;$$
\text{LinearAttention}(Q,K,V) = \text{æ ¸å‡½æ•°}(Q,K)V
$$&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ï¼Œæ ¸å‡½æ•°å¯ä»¥æ˜¯é«˜æ–¯æ ¸ã€å¤šé¡¹å¼æ ¸æˆ–å…¶ä»–ç±»å‹çš„æ ¸å‡½æ•°  ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Mamba&lt;/strong&gt;ï¼šå°†æ³¨æ„åŠ›æœºåˆ¶æ›¿æ¢ä¸ºç»“æ„åŒ–çŠ¶æ€ç©ºé—´æ¨¡å‹ï¼ˆSSMï¼‰ï¼Œé€šè¿‡é€’å½’è®¡ç®—å®ç°é•¿åºåˆ—å¤„ç†  ã€‚Mambaåœ¨S4çš„åŸºç¡€ä¸Šæ”¹è¿›ï¼Œå¼•å…¥é€‰æ‹©æ€§å¤„ç†æœºåˆ¶ï¼Œå…è®¸æ¨¡å‹æ ¹æ®è¾“å…¥åŠ¨æ€ç”Ÿæˆå‚æ•°$\overline{A}$, $\overline{B}$, Î”ï¼Œä»è€Œå®ç°å¯¹ä¿¡æ¯çš„é€‰æ‹©æ€§ä¿ç•™å’Œå‹ç¼©  ã€‚å…¶çŠ¶æ€æ–¹ç¨‹ä¸ºï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;$$
h_t = \overline{A}h_{t-1} + \overline{B}x_t,\quad y_t = Ch_t
$$&lt;/p&gt;</description>
    </item>
  </channel>
</rss>

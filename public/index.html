<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head>
	<meta name="generator" content="Hugo 0.152.2"><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>My work notes</title>

<meta name="description" content="è®°å½•è®ºæ–‡é˜…è¯»ä¸ä»£ç å®è·µ">
<meta name="author" content="fandengdong">
<link rel="canonical" href="http://localhost:1313/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css" integrity="sha256-NDzEgLn/yPBMy&#43;XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" type="application/rss+xml" href="http://localhost:1313/index.xml" title="rss">
<link rel="alternate" hreflang="en" href="http://localhost:1313/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script><meta property="og:url" content="http://localhost:1313/">
  <meta property="og:site_name" content="My work notes">
  <meta property="og:title" content="æ¬¢è¿æ¥åˆ°æˆ‘çš„å·¥ä½œç©ºé—´">
  <meta property="og:description" content=" ğŸ“š æˆ‘çš„å·¥ä½œç¬”è®° è¿™é‡Œè®°å½•æˆ‘åœ¨äººå·¥æ™ºèƒ½ã€å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰å’Œå¼€å‘å·¥å…·æ–¹é¢çš„å­¦ä¹ ä¸å®è·µã€‚ æ¬¢è¿ä¸€èµ·æ¢ç´¢æŠ€æœ¯çš„è¾¹ç•Œï¼ ğŸ§  RL ğŸ’¬ LLM ğŸ§° å·¥å…·ç®± ">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="website">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="æ¬¢è¿æ¥åˆ°æˆ‘çš„å·¥ä½œç©ºé—´">
<meta name="twitter:description" content="è®°å½•è®ºæ–‡é˜…è¯»ä¸ä»£ç å®è·µ">

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "My work notes",
  "url": "http://localhost:1313/",
  "description": "è®°å½•è®ºæ–‡é˜…è¯»ä¸ä»£ç å®è·µ",
  "logo": "http://localhost:1313/favicon.ico",
  "sameAs": [
      
  ]
}
</script>
</head>
<body class="list" id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="My work notes (Alt + H)">My work notes</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/llm/" title="å¤§è¯­è¨€æ¨¡å‹ (LLM)">
                    <span>å¤§è¯­è¨€æ¨¡å‹ (LLM)</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/toolbox/" title="å·¥å…·ç®± (toolbox)">
                    <span>å·¥å…·ç®± (toolbox)</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/rl/" title="å¼ºåŒ–å­¦ä¹  (RL)">
                    <span>å¼ºåŒ–å­¦ä¹  (RL)</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/" title="æ¬¢è¿æ¥åˆ°æˆ‘çš„å·¥ä½œç©ºé—´">
                    <span class="active">æ¬¢è¿æ¥åˆ°æˆ‘çš„å·¥ä½œç©ºé—´</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main"> 
<div class="post-content"><div style="text-align: center; max-width: 700px; margin: 2rem auto; padding: 0 1rem;">
  <h2>ğŸ“š æˆ‘çš„å·¥ä½œç¬”è®°</h2>
  <p style="font-size: 1.1em; color: #555; line-height: 1.6;">
    è¿™é‡Œè®°å½•æˆ‘åœ¨äººå·¥æ™ºèƒ½ã€å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰å’Œå¼€å‘å·¥å…·æ–¹é¢çš„å­¦ä¹ ä¸å®è·µã€‚
    æ¬¢è¿ä¸€èµ·æ¢ç´¢æŠ€æœ¯çš„è¾¹ç•Œï¼
  </p>
<div style="display: flex; justify-content: center; gap: 2rem; margin-top: 2rem; flex-wrap: wrap;">
  <a href="/rl/" class="btn btn-primary" style="display: inline-block; padding: 0.8rem 1.5rem; background: #f0f8ff; border-radius: 12px; text-decoration: none; color: #2c3e50; font-weight: bold; box-shadow: 0 2px 6px rgba(0,0,0,0.1); transition: transform 0.2s, box-shadow 0.2s;">
    ğŸ§  RL
  </a>

  <a href="/llm/" class="btn btn-primary" style="display: inline-block; padding: 0.8rem 1.5rem; background: #f0f8ff; border-radius: 12px; text-decoration: none; color: #2c3e50; font-weight: bold; box-shadow: 0 2px 6px rgba(0,0,0,0.1); transition: transform 0.2s, box-shadow 0.2s;">
    ğŸ’¬ LLM
  </a>

  <a href="/toolbox/" class="btn btn-primary" style="display: inline-block; padding: 0.8rem 1.5rem; background: #f0f8ff; border-radius: 12px; text-decoration: none; color: #2c3e50; font-weight: bold; box-shadow: 0 2px 6px rgba(0,0,0,0.1); transition: transform 0.2s, box-shadow 0.2s;">
    ğŸ§° å·¥å…·ç®±
  </a>

</div>
  </div>
</div>


</div>

<article class="first-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">MOE - æ··åˆä¸“å®¶æ¶æ„
    </h2>
  </header>
  <div class="entry-content">
    <p></p>
  </div>
  <footer class="entry-footer"><span title='2025-12-25 00:00:00 +0000 UTC'>December 25, 2025</span>&nbsp;Â·&nbsp;<span>fandengdong</span></footer>
  <a class="entry-link" aria-label="post link to MOE - æ··åˆä¸“å®¶æ¶æ„" href="http://localhost:1313/llm/architecture/yarn%E6%8E%A8%E7%90%86%E6%89%A9%E5%B1%95%E6%8A%80%E6%9C%AF/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">MOE - æ··åˆä¸“å®¶æ¶æ„
    </h2>
  </header>
  <div class="entry-content">
    <p>æ··åˆä¸“å®¶ï¼ˆMixture of Experts, MoEï¼‰æ˜¯ä¸€ç§**æ¡ä»¶è®¡ç®—ï¼ˆconditional computationï¼‰**æ¶æ„ï¼Œæ—¨åœ¨åœ¨ä¸æ˜¾è‘—å¢åŠ è®¡ç®—æˆæœ¬çš„å‰æä¸‹æ‰©å±•æ¨¡å‹å®¹é‡ã€‚å®ƒå·²è¢«å¹¿æ³›åº”ç”¨äºç°ä»£å¤§è¯­è¨€æ¨¡å‹ï¼ˆå¦‚ Google çš„ GLaMã€Mixtralã€Qwen-MoEã€DeepSeek-MoE ç­‰ï¼‰ã€‚
MoE çš„æ ¸å¿ƒæ€æƒ³ ğŸ¯ ç›®æ ‡ï¼š æ‰©å¤§æ¨¡å‹å‚æ•°é‡ï¼ˆæå‡è¡¨è¾¾èƒ½åŠ›ï¼‰ ä¿æŒæ¯æ¬¡å‰å‘è®¡ç®—çš„ FLOPs åŸºæœ¬ä¸å˜ï¼ˆé«˜æ•ˆæ¨ç†ï¼‰ ğŸ”‘ å…³é”®æœºåˆ¶ï¼š æ¨¡å‹ç”±å¤šä¸ªâ€œä¸“å®¶â€ï¼ˆExpertsï¼‰ç»„æˆï¼Œæ¯ä¸ªä¸“å®¶æ˜¯ä¸€ä¸ªå­ç½‘ç»œï¼ˆå¦‚ FFNï¼‰ã€‚ å¼•å…¥ä¸€ä¸ªé—¨æ§ç½‘ç»œï¼ˆGating Networkï¼‰ï¼Œæ ¹æ®è¾“å…¥åŠ¨æ€å†³å®šæ¿€æ´»å“ªå‡ ä¸ªä¸“å®¶ã€‚ é€šå¸¸åªæ¿€æ´» Top-K ä¸ªä¸“å®¶ï¼ˆå¦‚ K=1 æˆ– K=2ï¼‰ï¼Œå…¶ä½™ä¸“å®¶ä¸å‚ä¸è®¡ç®—ã€‚ âœ… è¿™æ ·ï¼šæ€»å‚æ•°é‡ = æ‰€æœ‰ä¸“å®¶å‚æ•°ä¹‹å’Œï¼ˆå¾ˆå¤§ï¼‰ï¼Œä½†æ¯ token è®¡ç®—é‡ â‰ˆ K ä¸ªä¸“å®¶ï¼ˆå¾ˆå°ï¼‰ã€‚
</p>
  </div>
  <footer class="entry-footer"><span title='2025-12-24 00:00:00 +0000 UTC'>December 24, 2025</span>&nbsp;Â·&nbsp;<span>fandengdong</span></footer>
  <a class="entry-link" aria-label="post link to MOE - æ··åˆä¸“å®¶æ¶æ„" href="http://localhost:1313/llm/architecture/%E6%B7%B7%E5%90%88%E4%B8%93%E5%AE%B6%E6%9E%B6%E6%9E%84moe/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">RoPE - æ—‹è½¬ä½ç½®ç¼–ç è§£è¯»
    </h2>
  </header>
  <div class="entry-content">
    <p>æ—‹è½¬ä½ç½®ç¼–ç ï¼ˆRoPE, Rotary Position Embeddingï¼‰æ˜¯ä¸€ç§åœ¨Transformeræ¨¡å‹ä¸­å¼•å…¥ç›¸å¯¹ä½ç½®ä¿¡æ¯çš„æ–¹æ³•ï¼Œç”±è‹å‰‘æ—ç­‰äººåœ¨2021å¹´æå‡ºã€‚ç›¸æ¯”ä¼ ç»Ÿçš„ç»å¯¹ä½ç½®ç¼–ç ï¼ˆå¦‚BERTä¸­çš„å¯å­¦ä¹ ä½ç½®åµŒå…¥æˆ–æ­£å¼¦ä½ç½®ç¼–ç ï¼‰ï¼ŒRoPEé€šè¿‡å°†ä½ç½®ä¿¡æ¯ä»¥æ—‹è½¬å˜æ¢çš„æ–¹å¼èå…¥æ³¨æ„åŠ›æœºåˆ¶ï¼Œä½¿å¾—æ¨¡å‹å¤©ç„¶å…·å¤‡å¯¹ç›¸å¯¹ä½ç½®çš„æ„ŸçŸ¥èƒ½åŠ›ã€‚
å›é¡¾åŸå§‹ä½ç½®ç¼–ç  åœ¨Transformeræ¨¡å‹ä¸­ï¼Œä½ç½®ç¼–ç ï¼ˆPosition Encodingï¼‰ç”¨äºå°†è¾“å…¥åºåˆ—ä¸­çš„æ¯ä¸ªä½ç½®æ˜ å°„ä¸ºå‘é‡ï¼Œä»¥è¡¨ç¤ºå…¶ç›¸å¯¹ä½ç½®ä¿¡æ¯ã€‚åŸå§‹ä½ç½®ç¼–ç çš„å®ç°æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œå¦‚å¯å­¦ä¹ ä½ç½®åµŒå…¥ï¼ˆLearnable Position Embeddingï¼‰æˆ–æ­£å¼¦ä½ç½®ç¼–ç ï¼ˆSinusoidal Position Encodingï¼‰ã€‚
å‡è®¾æˆ‘ä»¬çš„è¯æ±‡è¡¨å¤§å°ä¸º[vocab_size, embedding_dim]ï¼Œè¾“å…¥å¥å­çš„tokené•¿åº¦ä¸ºseq_lenï¼Œæ¯ä¸ªtokenä¼šè¢«è½¬æ¢æˆä¸€ä¸ªvectorå‘é‡ï¼Œç»´åº¦ä¸º[embedding_dim]ï¼Œåˆ™æ•´ä¸ªè¾“å…¥å¥å­çš„shapeä¸º[ seq_len, embedding_dim]ã€‚
ä½†æ˜¯ï¼Œä¸ºäº†è®©æ¨¡å‹ç†è§£åºåˆ—çš„é¡ºåºï¼Œè¿˜éœ€è¦åŠ å…¥ä½ç½®ç¼–ç (Positional Encoding)ã€‚è¿™å°±æ˜¯è‘—åçš„å…¬å¼ï¼š
$$ PE_{(pos,2i)} = \sin\left(\frac{pos}{10000^{2i/d_{model}}}\right) $$
$$ PE_{(pos,2i&#43;1)} = \cos\left(\frac{pos}{10000^{2i/d_{model}}}\right) $$
posæ˜¯ä½ç½®ç´¢å¼•ï¼Œå³tokenåœ¨åºåˆ—ä¸­çš„ä½ç½®ï¼Œä»0å¼€å§‹ï¼› iæ˜¯ç»´åº¦ç´¢å¼•ï¼Œä»0å¼€å§‹åˆ°$(d_{model}-1)/2$ç»“æŸï¼Œè¡¨ç¤ºè¯åµŒå…¥çš„ç»´åº¦ï¼› $d_{model}$æ˜¯è¯åµŒå…¥ï¼ˆword embeddingï¼‰çš„ç»´åº¦embedding_dim è§‚å¯Ÿè¾“å…¥å¥å­çš„shape: [seq_len, embedding_dim]ï¼Œä½ç½®ç¼–ç çš„æ—¶å€™ï¼Œposå¯¹åº”çš„æ˜¯tokenåœ¨seq_lenç»´åº¦çš„ä½ç½®ï¼Œè€Œç»´åº¦ç´¢å¼•iå¯¹åº”è¯åµŒå…¥embedding_dimçš„ç»´åº¦ã€‚
pytorchä»£ç å®ç°:
class PositionalEncoding(nn.Module): def __init__(self, d_model, max_len=5000): super().__init__() pe = torch.zeros(max_len, d_model) position = torch.arange(0, max_len).unsqueeze(1).float() div_term = torch.exp(torch.arange(0, d_model, 2).float() * -(torch.log(torch.tensor(10000.0)) / d_model)) pe[:, 0::2] = torch.sin(position * div_term) pe[:, 1::2] = torch.cos(position * div_term) self.register_buffer(&#39;pe&#39;, pe.unsqueeze(0)) def forward(self, x): return x &#43; self.pe[:, :x.size(1)] RoPE çš„æ ¸å¿ƒæ€æƒ³ ç›¸å¯¹ä½ç½® vs ç»å¯¹ä½ç½® åœ¨ä¼ ç»ŸTransformerä¸­ï¼Œä½ç½®ç¼–ç æ˜¯åŠ åˆ°è¯åµŒå…¥ä¸Šçš„ï¼ˆå¦‚ x &#43; pos_embï¼‰ï¼Œè¿™ç§æ–¹å¼åªä¿ç•™äº†ç»å¯¹ä½ç½®ä¿¡æ¯ã€‚ è€Œ RoPE åˆ™é€šè¿‡å°†æŸ¥è¯¢ï¼ˆQï¼‰å’Œé”®ï¼ˆKï¼‰å‘é‡è¿›è¡Œæ—‹è½¬å˜æ¢ï¼Œä½¿å¾—æ³¨æ„åŠ›åˆ†æ•°è‡ªç„¶åŒ…å«ä¸¤ä¸ª token ä¹‹é—´çš„ç›¸å¯¹è·ç¦»ã€‚ æ—‹è½¬æ“ä½œ å¯¹äºç»´åº¦ä¸º d çš„å‘é‡ï¼ŒRoPE å°†å…¶åˆ†æˆè‹¥å¹²äºŒç»´å­ç©ºé—´ï¼ˆé€šå¸¸æ˜¯ç›¸é‚»ä¸¤ä¸ªç»´åº¦ä¸€ç»„ï¼‰ï¼Œæ¯ç»„åº”ç”¨ä¸€ä¸ªäºŒç»´æ—‹è½¬çŸ©é˜µï¼š
...</p>
  </div>
  <footer class="entry-footer"><span title='2025-12-19 00:00:00 +0000 UTC'>December 19, 2025</span>&nbsp;Â·&nbsp;<span>fandengdong</span></footer>
  <a class="entry-link" aria-label="post link to RoPE - æ—‹è½¬ä½ç½®ç¼–ç è§£è¯»" href="http://localhost:1313/llm/architecture/rope/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">ä¸€åˆ‡çš„å¼€å§‹ - Transformeræ¶æ„
    </h2>
  </header>
  <div class="entry-content">
    <p>Transformerçš„è¯ç”ŸèƒŒæ™¯ åœ¨æ·±åº¦å­¦ä¹ çš„ä¸–ç•Œé‡Œï¼Œåºåˆ—å»ºæ¨¡ä¸€ç›´æ˜¯ä¸ªè€å¤§éš¾é—®é¢˜ã€‚ä¼ ç»Ÿçš„å¾ªç¯ç¥ç»ç½‘ç»œ(RNN)è™½ç„¶èƒ½å¤Ÿå¤„ç†åºåˆ—æ•°æ®ï¼Œä½†åœ¨å¤„ç†é•¿åºåˆ—æ—¶å­˜åœ¨æ¢¯åº¦æ¶ˆå¤±å’Œè®¡ç®—æ•ˆç‡ä½ä¸‹çš„é—®é¢˜ã€‚è€Œå·ç§¯ç¥ç»ç½‘ç»œ(CNN)è™½ç„¶å¹¶è¡ŒåŒ–ç¨‹åº¦é«˜ï¼Œä½†åœ¨æ•æ‰é•¿è·ç¦»ä¾èµ–å…³ç³»æ–¹é¢åŠ›ä¸ä»å¿ƒã€‚
å°±åœ¨è¿™ä¸ªå…³é”®æ—¶åˆ»ï¼ŒGoogleçš„å¤§ç¥ä»¬åœ¨2017å¹´æ‰”å‡ºäº†ä¸€ä¸ª&#34;æ ¸å¼¹çº§&#34;çš„è§£å†³æ–¹æ¡ˆâ€”â€”ã€ŠAttention Is All You Needã€‹ã€‚è¿™ç¯‡è®ºæ–‡å½»åº•é¢ è¦†äº†äººä»¬å¯¹åºåˆ—å»ºæ¨¡çš„è®¤çŸ¥ï¼Œæå‡ºäº†å®Œå…¨åŸºäºæ³¨æ„åŠ›æœºåˆ¶çš„Transformeræ¶æ„ã€‚
ç¿»è¯‘ä»»åŠ¡ï¼šTransformerçš„è¯•éªŒåœº Transformeræœ€åˆæ˜¯ä¸ºäº†æœºå™¨ç¿»è¯‘ä»»åŠ¡è€Œè®¾è®¡çš„ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ è¦æŠŠä¸€å¥ä¸­æ–‡ç¿»è¯‘æˆè‹±æ–‡ï¼š
ä¸­æ–‡è¾“å…¥: â€œæˆ‘å–œæ¬¢å­¦ä¹ äººå·¥æ™ºèƒ½â€
è‹±æ–‡è¾“å‡º: â€œI like studying artificial intelligenceâ€
åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ¨¡å‹éœ€è¦ç†è§£æ¯ä¸ªè¯çš„å«ä¹‰ï¼Œå¹¶æ‰¾åˆ°å®ƒä»¬ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚ä¼ ç»Ÿçš„Seq2Seqæ¨¡å‹ä¾èµ–RNNæ¥ç¼–ç è¾“å…¥åºåˆ—ï¼Œä½†æ•ˆæœæœ‰é™ã€‚è€ŒTransformeré€šè¿‡è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼Œèƒ½å¤ŸåŒæ—¶å…³æ³¨è¾“å…¥åºåˆ—ä¸­çš„æ‰€æœ‰ä½ç½®ï¼Œå¤§å¤§æå‡äº†ç¿»è¯‘è´¨é‡ã€‚
Transformerçš„åŸºæœ¬è¾“å…¥è¾“å‡º è¾“å…¥çš„ç§˜å¯† Transformerçš„è¾“å…¥å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ªä¸ªtokenï¼ˆå¯ä»¥æ˜¯å•è¯ã€å­è¯æˆ–è€…å­—ç¬¦ï¼‰ã€‚å‡è®¾æˆ‘ä»¬çš„è¯æ±‡è¡¨å¤§å°ä¸º[vocab_size, embedding_dim]ï¼Œè¾“å…¥å¥å­çš„tokené•¿åº¦ä¸ºseq_lenï¼Œæ¯ä¸ªtokenä¼šè¢«è½¬æ¢æˆä¸€ä¸ªvectorå‘é‡ï¼Œç»´åº¦ä¸º[embedding_dim]ï¼Œåˆ™æ•´ä¸ªè¾“å…¥å¥å­çš„shapeä¸º[ seq_len, embedding_dim]ã€‚
ä½†æ˜¯ï¼Œä¸ºäº†è®©æ¨¡å‹ç†è§£åºåˆ—çš„é¡ºåºï¼Œè¿˜éœ€è¦åŠ å…¥ä½ç½®ç¼–ç (Positional Encoding)ã€‚è¿™å°±æ˜¯è‘—åçš„å…¬å¼ï¼š
$$ PE_{(pos,2i)} = \sin\left(\frac{pos}{10000^{2i/d_{model}}}\right) $$
$$ PE_{(pos,2i&#43;1)} = \cos\left(\frac{pos}{10000^{2i/d_{model}}}\right) $$
posæ˜¯ä½ç½®ç´¢å¼•ï¼Œå³tokenåœ¨åºåˆ—ä¸­çš„ä½ç½®ï¼Œä»0å¼€å§‹ï¼› iæ˜¯ç»´åº¦ç´¢å¼•ï¼Œä»0å¼€å§‹åˆ°$d_{model}-1$ç»“æŸï¼Œè¡¨ç¤ºè¯åµŒå…¥çš„ç»´åº¦ï¼› $d_{model}$æ˜¯è¯åµŒå…¥ï¼ˆword embeddingï¼‰çš„ç»´åº¦embedding_dim è§‚å¯Ÿè¾“å…¥å¥å­çš„shape: [seq_len, embedding_dim]ï¼Œä½ç½®ç¼–ç çš„æ—¶å€™ï¼Œposå¯¹åº”çš„æ˜¯tokenåœ¨seq_lenç»´åº¦çš„ä½ç½®ï¼Œè€Œç»´åº¦ç´¢å¼•iå¯¹åº”è¯åµŒå…¥embedding_dimçš„ç»´åº¦ã€‚
è¾“å‡ºçš„é­…åŠ› Transformerçš„è¾“å‡ºåŒæ ·æ˜¯ä¸€ç³»åˆ—tokenï¼Œä½†å®ƒè¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šä¹‹å¤„â€”â€”å®ƒæ˜¯ä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒã€‚å¯¹äºæ¯ä¸ªæ—¶é—´æ­¥ï¼Œæ¨¡å‹ä¼šè¾“å‡ºè¯æ±‡è¡¨ä¸­æ¯ä¸ªè¯çš„æ¦‚ç‡ï¼Œç„¶åé€šè¿‡è´ªå©ªæœç´¢æˆ–æŸæœç´¢æ¥é€‰æ‹©æœ€åˆé€‚çš„è¯ã€‚è¿™äº›æœç´¢ç®—æ³•æ„æˆäº†æ¨ç†æ—¶æ‰©å±•ç®—æ³•çš„åŸºç¡€ã€‚
è¡¥å……è´ªå©ªæœç´¢å’ŒæŸæœç´¢çš„ç®—æ³•ï¼š
è´ªå©ªæœç´¢æ˜¯ä¸€ç§ç®€å•ç›´æ¥çš„è§£ç ç­–ç•¥ã€‚åœ¨æ¯ä¸ªæ—¶é—´æ­¥ï¼Œå®ƒæ€»æ˜¯é€‰æ‹©å…·æœ‰æœ€é«˜æ¦‚ç‡çš„tokenä½œä¸ºä¸‹ä¸€ä¸ªè¾“å‡ºï¼Œä¸è€ƒè™‘åç»­å¯èƒ½çš„å½±å“ã€‚ä¼˜ç‚¹æ˜¯è®¡ç®—ç®€å•ï¼Œé€Ÿåº¦å¿«ï¼Œå†…å­˜å ç”¨å°‘ï¼›ç¼ºç‚¹åˆ™æ˜¯å®¹æ˜“é™·å…¥å±€éƒ¨æœ€ä¼˜ï¼Œç”Ÿæˆç»“æœç¼ºä¹å¤šæ ·æ€§ã€‚ æŸæœç´¢æ˜¯å¯¹è´ªå©ªæœç´¢çš„æ”¹è¿›ï¼Œåœ¨æ¯ä¸ªæ—¶é—´æ­¥ä¿ç•™beam_widthä¸ªæœ€æœ‰å¸Œæœ›çš„å€™é€‰åºåˆ—ï¼Œè€Œä¸æ˜¯åªä¿ç•™ä¸€ä¸ªã€‚ç›¸æ¯”è´ªå©ªæœç´¢èƒ½æ‰¾åˆ°æ›´ä¼˜çš„åºåˆ—ï¼Œåœ¨åˆç†çš„æ—¶é—´å†…æ¢ç´¢å¤šä¸ªå¯èƒ½æ€§ï¼›ç¼ºç‚¹åˆ™æ˜¯è®¡ç®—å¤æ‚åº¦è¾ƒé«˜ï¼Œéœ€è¦è°ƒæ•´beam_widthå‚æ•°ï¼Œä»å¯èƒ½é”™è¿‡å…¨å±€æœ€ä¼˜è§£ã€‚ æ ¸å¿ƒæ¨¡å—ï¼šEncoderå’ŒDecoder Transformerçš„æ ¸å¿ƒç”±ä¸¤å¤§éƒ¨åˆ†ç»„æˆï¼šEncoderå’ŒDecoderã€‚
Encoderï¼šä¿¡æ¯çš„åŠ å·¥å‚ Encoderè´Ÿè´£å°†è¾“å…¥åºåˆ—è½¬æ¢æˆä¸€ç³»åˆ—éšè—è¡¨ç¤ºã€‚å®ƒç”±Nä¸ªç›¸åŒçš„å±‚å †å è€Œæˆï¼Œæ¯ä¸€å±‚éƒ½åŒ…å«ä¸¤ä¸ªå­å±‚ï¼š
å¤šå¤´è‡ªæ³¨æ„åŠ›æœºåˆ¶(Multi-Head Self-Attention) ä½ç½®å…¨è¿æ¥å‰é¦ˆç½‘ç»œ(Position-wise Feed-Forward Networks) æ¯å±‚éƒ½æœ‰æ®‹å·®è¿æ¥å’Œå±‚å½’ä¸€åŒ–ï¼Œè¿™ä½¿å¾—æ·±å±‚ç½‘ç»œä¹Ÿèƒ½ç¨³å®šè®­ç»ƒã€‚
Decoderï¼šåˆ›ä½œçš„è‰ºæœ¯å®¶ Decoderåˆ™è´Ÿè´£æ ¹æ®Encoderçš„è¾“å‡ºå’Œä¹‹å‰ç”Ÿæˆçš„tokenæ¥é¢„æµ‹ä¸‹ä¸€ä¸ªtokenã€‚å®ƒçš„ç»“æ„æ¯”Encoderç¨å¤æ‚ä¸€äº›ï¼ŒåŒ…å«ä¸‰ä¸ªå­å±‚ï¼š
æ©ç å¤šå¤´è‡ªæ³¨æ„åŠ›æœºåˆ¶(Masked Multi-Head Self-Attention) å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶(Multi-Head Attention) ä½ç½®å…¨è¿æ¥å‰é¦ˆç½‘ç»œ(Position-wise Feed-Forward Networks) å…¶ä¸­æ©ç æœºåˆ¶ç¡®ä¿åœ¨ç”Ÿæˆå½“å‰ä½ç½®çš„è¾“å‡ºæ—¶ï¼Œåªèƒ½çœ‹åˆ°ä¹‹å‰çš„ä½ç½®ï¼Œä¸èƒ½&#34;å·çœ‹&#34;æœªæ¥çš„ä¿¡æ¯ã€‚
...</p>
  </div>
  <footer class="entry-footer"><span title='2025-12-19 00:00:00 +0000 UTC'>December 19, 2025</span>&nbsp;Â·&nbsp;<span>fandengdong</span></footer>
  <a class="entry-link" aria-label="post link to ä¸€åˆ‡çš„å¼€å§‹ - Transformeræ¶æ„" href="http://localhost:1313/llm/architecture/transformer/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">ç»¼è¿° - Transformeræ¶æ„çš„æ¼”è¿›
    </h2>
  </header>
  <div class="entry-content">
    <p>Transformeræ¶æ„æ¼”è¿›ï¼šä»è‡ªæ³¨æ„åŠ›åˆ°é•¿åºåˆ—ä¸å¤šæ¨¡æ€çš„é©å‘½æ€§çªç ´ Transformerè‡ª2017å¹´æå‡ºä»¥æ¥ï¼Œå·²æˆä¸ºæ·±åº¦å­¦ä¹ é¢†åŸŸçš„åŸºçŸ³æ¶æ„ï¼Œå…¶æ¼”è¿›å†ç¨‹åæ˜ äº†AIç ”ç©¶è€…å¯¹è®¡ç®—æ•ˆç‡ã€é•¿åºåˆ—å¤„ç†èƒ½åŠ›å’Œè·¨æ¨¡æ€åº”ç”¨çš„ä¸æ‡ˆè¿½æ±‚ã€‚ä»æœ€åˆçš„O(nÂ²)è®¡ç®—å¤æ‚åº¦åˆ°å¦‚ä»Šçš„O(n)çº¿æ€§å¤æ‚åº¦ï¼Œä»å•æ¨¡æ€æ–‡æœ¬å¤„ç†åˆ°åŸç”Ÿå¤šæ¨¡æ€æ¶æ„ï¼ŒTransformerçš„æ¼”è¿›ä¸ä»…è§£å†³äº†è‡ªèº«å±€é™ï¼Œæ›´æ¨åŠ¨äº†å¤§è¯­è¨€æ¨¡å‹ã€è§†è§‰æ¨¡å‹å’Œå¤šæ¨¡æ€ç³»ç»Ÿçš„é©å‘½æ€§å‘å±•ã€‚è¿™äº›æ¼”è¿›ä¸»è¦ä½“ç°åœ¨æ³¨æ„åŠ›æœºåˆ¶åˆ›æ–°ã€ä½ç½®ç¼–ç æ”¹è¿›ã€æ¨¡å‹æ¶æ„å˜ä½“ä¸æ‰©å±•ã€è®­ç»ƒæ¨ç†æ•ˆç‡ä¼˜åŒ–å››å¤§æ–¹å‘ï¼Œå…±åŒæ„å»ºäº†ç°ä»£AIç³»ç»Ÿçš„è®¡ç®—åŸºç¡€ã€‚
ä¸€ã€æ³¨æ„åŠ›æœºåˆ¶çš„æ¼”è¿›ï¼šä»å…¨å±€åˆ°ç¨€ç–å†åˆ°çŠ¶æ€ç©ºé—´æ¨¡å‹ TransformeråŸå§‹æ¶æ„çš„æ ¸å¿ƒæ˜¯è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼Œå®ƒé€šè¿‡è®¡ç®—æŸ¥è¯¢(Q)ã€é”®(K)å’Œå€¼(V)ä¹‹é—´çš„ç›¸ä¼¼åº¦æ¥æ•æ‰åºåˆ—å†…éƒ¨çš„é•¿è·ç¦»ä¾èµ–å…³ç³» ã€‚æ ‡å‡†è‡ªæ³¨æ„åŠ›çš„è®¡ç®—å…¬å¼ä¸ºï¼š
$$ \text{Attention}(Q,K,V) = \text{softmax}\left( \frac{QK^\top}{\sqrt{d_k}} \right)V $$
å…¶ä¸­ï¼Œ$Qâˆˆâ„^{nÃ—d_k}$ï¼Œ$Kâˆˆâ„^{nÃ—d_k}$ï¼Œ$Vâˆˆâ„^{nÃ—d_v}$ï¼Œd_kæ˜¯é”®å‘é‡çš„ç»´åº¦ã€‚è¿™ä¸€æœºåˆ¶è™½ç„¶å¼ºå¤§ï¼Œä½†è®¡ç®—å¤æ‚åº¦ä¸ºO(nÂ²)ï¼Œéšç€åºåˆ—é•¿åº¦nçš„å¢åŠ å‘ˆå¹³æ–¹å¢é•¿ï¼Œä¸¥é‡é™åˆ¶äº†å¤„ç†é•¿æ–‡æœ¬çš„èƒ½åŠ›ã€‚
ä¸ºè§£å†³è¿™ä¸€ç“¶é¢ˆï¼Œç ”ç©¶è€…ä»å¤šä¸ªè§’åº¦å¯¹æ³¨æ„åŠ›æœºåˆ¶è¿›è¡Œäº†åˆ›æ–°ï¼š
1. ç¨€ç–æ³¨æ„åŠ›æœºåˆ¶
ç¨€ç–æ³¨æ„åŠ›é€šè¿‡é™åˆ¶æ¯ä¸ªtokenåªèƒ½å…³æ³¨åºåˆ—ä¸­çš„å±€éƒ¨åŒºåŸŸï¼Œå°†è®¡ç®—å¤æ‚åº¦ä»O(nÂ²)é™è‡³O(n)ã€‚ä¸»è¦ä»£è¡¨åŒ…æ‹¬ï¼š
Longformerï¼šé‡‡ç”¨æ»‘åŠ¨çª—å£æ³¨æ„åŠ›æœºåˆ¶ï¼Œæ¯ä¸ªtokenä»…å…³æ³¨å…¶å‘¨å›´å›ºå®šçª—å£å†…çš„tokenï¼ŒåŒæ—¶ä¿ç•™å°‘æ•°å…¨å±€tokenä»¥ç»´æŒä¸Šä¸‹æ–‡è¿è´¯æ€§ ã€‚å…¶çª—å£æ³¨æ„åŠ›å…¬å¼ä¸ºï¼š $$ \text{WindowAttention}(Q,K,V) = \text{softmax}\left( \frac{QK^\top}{\sqrt{d_k}} \right)V_{\text{window}} $$
å…¶ä¸­ï¼ŒV_windowæ˜¯çª—å£å†…å€¼å‘é‡çš„å­é›†ï¼Œçª—å£å¤§å°é€šå¸¸ä¸º512æˆ–1024ä¸ªtoken ã€‚
BigBirdï¼šç»“åˆä¸‰ç§æ³¨æ„åŠ›æ¨¡å¼â€”â€”éšæœºæ³¨æ„åŠ›ï¼ˆé€šè¿‡ErdÅ‘s-RÃ©nyiå›¾é‡‡æ ·ï¼‰ã€æ»‘åŠ¨çª—å£æ³¨æ„åŠ›å’Œå…¨å±€æ³¨æ„åŠ› ã€‚éšæœºæ³¨æ„åŠ›ä½¿æ¨¡å‹èƒ½å¤Ÿæ•æ‰é•¿è·ç¦»ä¾èµ–ï¼ŒåŒæ—¶ä¿æŒO(n)çš„çº¿æ€§å¤æ‚åº¦ã€‚å…¶éšæœºæ³¨æ„åŠ›çŸ©é˜µå¯ä»¥è¡¨ç¤ºä¸ºï¼š $$ \text{RandomAttention}(Q,K,V) = \text{softmax}\left( \frac{QW_{\text{random}}K^\top}{\sqrt{d_k}} \right)V_{\text{random}} $$
å…¶ä¸­ï¼Œ$W_{random}$æ˜¯éšæœºæ©ç çŸ©é˜µï¼Œ$V_{random}$æ˜¯éšæœºé‡‡æ ·å€¼å‘é‡çš„å­é›† ã€‚
å±€éƒ¨å¢å¼ºMambaï¼ˆLEVMï¼‰ï¼šåœ¨Mambaæ¶æ„ä¸­ï¼Œé€šè¿‡åŠ¨æ€é€‰æ‹©æ€§å¤„ç†ï¼Œå¯¹é‡è¦ä¿¡æ¯ä¿ç•™å®Œæ•´çŠ¶æ€ï¼Œå¯¹ä¸é‡è¦ä¿¡æ¯è¿›è¡Œå‹ç¼©ï¼Œå®ç°O(n)è®¡ç®—å¤æ‚åº¦å’ŒO(1)æ˜¾å­˜å ç”¨ ã€‚å…¶æ ¸å¿ƒçŠ¶æ€æ–¹ç¨‹ä¸ºï¼š $$ h_t = \overline{A}h_{t-1} &#43; \overline{B}x_t $$
å…¶ä¸­ï¼Œ$\overline{A}$å’Œ$\overline{B}$æ˜¯åŠ¨æ€ç”Ÿæˆçš„å‚æ•°çŸ©é˜µï¼Œå…è®¸æ¨¡å‹æ ¹æ®è¾“å…¥é€‰æ‹©æ€§åœ°ä¿ç•™ä¿¡æ¯ ã€‚
2. çº¿æ€§æ³¨æ„åŠ›æœºåˆ¶
çº¿æ€§æ³¨æ„åŠ›é€šè¿‡æ•°å­¦è¿‘ä¼¼æŠ€æœ¯ï¼Œå°†æ³¨æ„åŠ›è®¡ç®—çš„å¤æ‚åº¦é™è‡³O(n)ï¼ŒåŒæ—¶ä¿æŒæ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ã€‚ä¸»è¦ä»£è¡¨åŒ…æ‹¬ï¼š
Performerï¼šé‡‡ç”¨æ ¸å‡½æ•°è¿‘ä¼¼æ–¹æ³•ï¼Œå°†æ ‡å‡†æ³¨æ„åŠ›å…¬å¼ä¸­çš„softmax(QKáµ€)æ›¿æ¢ä¸ºæ ¸å‡½æ•°K(Q,K)ï¼Œä½¿å¾—è®¡ç®—å¯ä»¥åˆ†è§£ä¸ºO(n)çš„çº¿æ€§æ“ä½œ ã€‚å…¶æ ¸å¿ƒå…¬å¼ä¸ºï¼š $$ \text{LinearAttention}(Q,K,V) = \text{æ ¸å‡½æ•°}(Q,K)V $$
å…¶ä¸­ï¼Œæ ¸å‡½æ•°å¯ä»¥æ˜¯é«˜æ–¯æ ¸ã€å¤šé¡¹å¼æ ¸æˆ–å…¶ä»–ç±»å‹çš„æ ¸å‡½æ•° ã€‚
Mambaï¼šå°†æ³¨æ„åŠ›æœºåˆ¶æ›¿æ¢ä¸ºç»“æ„åŒ–çŠ¶æ€ç©ºé—´æ¨¡å‹ï¼ˆSSMï¼‰ï¼Œé€šè¿‡é€’å½’è®¡ç®—å®ç°é•¿åºåˆ—å¤„ç† ã€‚Mambaåœ¨S4çš„åŸºç¡€ä¸Šæ”¹è¿›ï¼Œå¼•å…¥é€‰æ‹©æ€§å¤„ç†æœºåˆ¶ï¼Œå…è®¸æ¨¡å‹æ ¹æ®è¾“å…¥åŠ¨æ€ç”Ÿæˆå‚æ•°$\overline{A}$, $\overline{B}$, Î”ï¼Œä»è€Œå®ç°å¯¹ä¿¡æ¯çš„é€‰æ‹©æ€§ä¿ç•™å’Œå‹ç¼© ã€‚å…¶çŠ¶æ€æ–¹ç¨‹ä¸ºï¼š $$ h_t = \overline{A}h_{t-1} &#43; \overline{B}x_t,\quad y_t = Ch_t $$
...</p>
  </div>
  <footer class="entry-footer"><span title='2025-12-19 00:00:00 +0000 UTC'>December 19, 2025</span>&nbsp;Â·&nbsp;<span>fandengdong</span></footer>
  <a class="entry-link" aria-label="post link to ç»¼è¿° - Transformeræ¶æ„çš„æ¼”è¿›" href="http://localhost:1313/llm/architecture/transformer%E6%9E%B6%E6%9E%84%E7%9A%84%E6%BC%94%E8%BF%9B/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">ä½¿ç”¨ Mindspeed-LLMè¿›è¡Œæ¨ç†
    </h2>
  </header>
  <div class="entry-content">
    <p>æœ¬æ–‡è®°å½•äº† mindspeed-llm æ¡†æ¶æä¾›çš„æ¨ç†æ–¹æ³•ï¼Œä»¥ Qwen2.5-7B æ¨¡å‹ä¸ºä¾‹è¯´æ˜æ¨ç†è¿‡ç¨‹ã€‚
å‡†å¤‡å·¥ä½œ æ¨ç†æ¨¡å‹çš„æƒé‡éœ€è¦è½¬æ¢ä¸º mcore æ ¼å¼ï¼Œæ–¹æ³•ä¸å¾®è°ƒæ—¶ç›¸åŒï¼Œå‚è€ƒè¿™é‡Œ
å¼€å¯æ¨ç†æµ‹è¯• å‡†å¤‡å¥½æ¨¡å‹æƒé‡åï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ mindspeed-llm æä¾›çš„æ¨ç†è„šæœ¬è¿›è¡Œæ¨ç†æµ‹è¯•ï¼Œè„šæœ¬ä½äºexamples/mcore/qwen25/generate_qwen25_7b_ptd.sh
#!/bin/bash export CUDA_DEVICE_MAX_CONNECTIONS=1 # please fill these path configurations CHECKPOINT=&#34;/home/fdd/workspace/models/Qwen/Qwen2.5-7B/mcore_tp1_pp1/&#34; TOKENIZER_PATH=&#34;/home/fdd/workspace/models/Qwen/Qwen2.5-7B-Instruct/&#34; # Change for multinode config MASTER_ADDR=localhost MASTER_PORT=6000 NNODES=1 NODE_RANK=0 NPUS_PER_NODE=1 WORLD_SIZE=$(($NPUS_PER_NODE*$NNODES)) TP=1 PP=1 SEQ_LENGTH=32768 ... torchrun $DISTRIBUTED_ARGS inference.py \ --use-mcore-models \ ... å¯ä»¥çœ‹åˆ°å¯¹äº 7B æ¨¡å‹ï¼Œé‡‡ç”¨å•å¡å°±å¯ä»¥è¿›è¡Œæ¨ç†ã€‚å¯åŠ¨æ–¹å¼ä¾ç„¶ä¸º torchrunï¼Œå¯åŠ¨è„šæœ¬ä¸º inference.pyã€‚
æ¨ç†æµç¨‹ æŸ¥çœ‹inference.pyæ–‡ä»¶ï¼š
from megatron.training.initialize import initialize_megatron from mindspeed_llm.tasks.inference.module import GPTModelInfer, MegatronModuleForCausalLM def main(): initialize_megatron(args_defaults={&#39;no_load_rng&#39;: True, &#39;no_load_optim&#39;: True}) args = get_args() model = MegatronModuleForCausalLM.from_pretrained( model_provider=model_provider, pretrained_model_name_or_path=args.load ) task_factory(args, model) if __name__ == &#34;__main__&#34;: main() å¯æ¨ç†æµç¨‹çš„å…³é”®æ­¥éª¤åŒ…æ‹¬ï¼š
...</p>
  </div>
  <footer class="entry-footer"><span title='2025-11-14 00:00:00 +0000 UTC'>November 14, 2025</span>&nbsp;Â·&nbsp;<span>fandengdong</span></footer>
  <a class="entry-link" aria-label="post link to ä½¿ç”¨ Mindspeed-LLMè¿›è¡Œæ¨ç†" href="http://localhost:1313/llm/mindspeed_llm/mindspeed_llm_inference/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">ä½¿ç”¨ Mindspeed-LLMè¿›è¡Œè®­ç»ƒ
    </h2>
  </header>
  <div class="entry-content">
    <p>æœ¬æŒ‡å—è®°å½•é‡‡ç”¨mindspeed-llmè¿›è¡Œè®­ç»ƒçš„æ­¥éª¤ï¼Œä»¥å¾®è°ƒä¸ºä¾‹ã€‚
å‡†å¤‡æ•°æ® å‡†å¤‡æ•°æ®é›†çš„jsonlæ–‡ä»¶ï¼Œæ¯ä¸ªæ ·æœ¬æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œè‡³å°‘è¦åŒ…å«å…³é”®å­—promptå’Œresponseï¼Œå…¶ä¸­promptä¸ºè¾“å…¥ï¼Œresponseä¸ºè¾“å‡ºã€‚
æ³¨æ„ï¼šå¦‚æœæä¾›çš„jsonlæ–‡ä»¶é‡Œé¢æ²¡æœ‰åŒ…å«chat templateï¼Œé‚£ä¹ˆåœ¨è½¬æ¢æ•°æ®çš„æ—¶å€™è¦æ·»åŠ prompt-typeå‚æ•°æ¥æä¾›æ¨¡æ¿ã€‚ä¸‹é¢æä¾›ä¸€ä¸ªå¸¦äº†chat templatedçš„jsonlæ–‡ä»¶æ ·ä¾‹ï¼š
{&#34;prompt&#34;:&#34;&lt;|im_start|&gt;system\nYou are a helpful assistant. To answer the user\&#39;s question, you first think about the reasoning process and then provide the user with the answer. The reasoning process and answer are enclosed within &lt;think&gt; &lt;\/think&gt; and &lt;answer&gt; &lt;\/answer&gt; tags, respectively, i.e., &lt;think&gt; reasoning process here &lt;\/think&gt; &lt;answer&gt; answer here &lt;\/answer&gt;.&lt;|im_end|&gt;\n&lt;|im_start|&gt;user\nLet $\\triangle ABC$ have circumcenter $O$ and incenter $I$ with $\\overline{IA}\\perp\\overline{OI}$, circumradius $13$, and inradius $6$. Find $AB\\cdot AC$.\nPlease reason step by step, and put your final answer within \\boxed{}.\nPlease reason step by step, and put your final answer within \\boxed{}.&lt;|im_end|&gt;\n&lt;|im_start|&gt;assistant\n&#34;,&#34;response&#34;:&#34;&lt;think&gt;\nI have a geometry problem. We have a triangle ABC with circumcenter O and incenter I....&#34;} {&#34;prompt&#34;:&#34;&lt;|im_start|&gt;system\nYou are a helpful assistant. To answer the user\&#39;s question, you first think about the reasoning process and then provide the user with the answer. The reasoning process and answer are enclosed within &lt;think&gt; &lt;\/think&gt; and &lt;answer&gt; &lt;\/answer&gt; tags, respectively, i.e., &lt;think&gt; reasoning process here &lt;\/think&gt; &lt;answer&gt; answer here &lt;\/answer&gt;.&lt;|im_end|&gt;\n&lt;|im_start|&gt;user\nLet \\(b\\ge 2\\) be an integer. Call a positive integer \\(n\\) \\(b\\text-\\textit{eautiful}\\) if it has exactly two digits when expressed in base \\(b\\) and these two digits sum to \\(\\sqrt n\\). For example, \\(81\\) is \\(13\\text-\\textit{eautiful}\\) because \\(81 = \\underline{6} \\ \\underline{3}_{13} \\) and \\(6 &#43; 3 = \\sqrt{81}\\). Find the least integer \\(b\\ge 2\\) for which there are more than ten \\(b\\text-\\textit{eautiful}\\) integers.\nPlease reason step by step, and put your final answer within \\boxed{}.\nPlease reason step by step, and put your final answer within \\boxed{}.&lt;|im_end|&gt;\n&lt;|im_start|&gt;assistant\n&#34;,&#34;response&#34;:&#34;&lt;think&gt;\nThe problem defines a \&#34;b-beautiful\&#34; number as a positive integer...&#34;} å‡†å¤‡å¥½jsonlæ–‡ä»¶åï¼Œåˆ©ç”¨mindspeed-llmè‡ªå¸¦çš„è„šæœ¬preprocess_data.pyæ¥é¢„å¤„ç†æ•°æ®ï¼š
...</p>
  </div>
  <footer class="entry-footer"><span title='2025-11-14 00:00:00 +0000 UTC'>November 14, 2025</span>&nbsp;Â·&nbsp;<span>fandengdong</span></footer>
  <a class="entry-link" aria-label="post link to ä½¿ç”¨ Mindspeed-LLMè¿›è¡Œè®­ç»ƒ" href="http://localhost:1313/llm/mindspeed_llm/mindspeed_llm_finetune/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">å¼€å§‹ä½¿ç”¨ Mindspeed è¿›è¡Œå¤§æ¨¡å‹è®­ç»ƒ
    </h2>
  </header>
  <div class="entry-content">
    <p>æœ¬æ–‡é€šè¿‡ä¸€ä¸ªå®Œæ•´ç¤ºä¾‹ä»£ç æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ Mindspeed æ¡†æ¶è¿›è¡Œåˆ†å¸ƒå¼å¤§æ¨¡å‹è®­ç»ƒã€‚
ç¯å¢ƒç‰ˆæœ¬ä¿¡æ¯
Mindspeed commit ID: 89f4632d Megatron åˆ†æ”¯: core_v0.12.1 CANN: 8.2.RC1 PyTorch: 2.5.1 1. åˆå§‹åŒ–åˆ†å¸ƒå¼å¹¶è¡Œç¯å¢ƒ Mindspeed åŸºäº Megatron æ„å»ºï¼Œæ”¯æŒå¼ é‡å¹¶è¡Œï¼ˆTPï¼‰å’Œæµæ°´çº¿å¹¶è¡Œï¼ˆPPï¼‰ã€‚åœ¨è®­ç»ƒå‰ï¼Œå¿…é¡»æ­£ç¡®åˆå§‹åŒ–åˆ†å¸ƒå¼ç¯å¢ƒï¼š
import os import torch import mindspeed.megatron_adaptor # å…³é”®ï¼šç¡®ä¿ Mindspeed ä¸ Megatron API å…¼å®¹ from megatron.core import parallel_state def initialize_distributed(tensor_model_parallel_size=1, pipeline_model_parallel_size=1): # æ¸…ç†å·²æœ‰çŠ¶æ€ï¼ˆé˜²æ­¢é‡å¤åˆå§‹åŒ–ï¼‰ parallel_state.destroy_model_parallel() # æ ‡å‡† PyTorch åˆ†å¸ƒå¼è®¾ç½® rank = int(os.environ.get(&#39;LOCAL_RANK&#39;, 0)) world_size = int(os.environ.get(&#34;WORLD_SIZE&#34;, 1)) torch.cuda.set_device(rank) torch.distributed.init_process_group(world_size=world_size, rank=rank) # åˆå§‹åŒ– Megatron å¹¶è¡ŒçŠ¶æ€ parallel_state.initialize_model_parallel( tensor_model_parallel_size=tensor_model_parallel_size, pipeline_model_parallel_size=pipeline_model_parallel_size ) å…³é”®ç‚¹è¯´æ˜ï¼š å¿…é¡»æ˜¾å¼å¯¼å…¥ mindspeed.megatron_adaptorï¼Œä»¥å¯ç”¨å…¼å®¹å±‚ã€‚ é™¤äº†æ ‡å‡†çš„ torch.distributed.init_process_groupï¼Œè¿˜éœ€è°ƒç”¨ parallel_state.initialize_model_parallel æ¥æ¿€æ´» TP/PP æ”¯æŒã€‚ éœ€æ ¹æ®å®é™…è®­ç»ƒé…ç½®ä¼ å…¥ tensor_model_parallel_size å’Œ pipeline_model_parallel_sizeã€‚
Mindspeed æ¨¡å‹åˆå§‹åŒ– Mindspeed ä½¿ç”¨ Megatron Core çš„æ¨¡å—åŒ–è®¾è®¡æ„å»ºæ¨¡å‹ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªæœ€å° GPT æ¨¡å‹çš„æ„å»ºç¤ºä¾‹ï¼š
...</p>
  </div>
  <footer class="entry-footer"><span title='2025-11-11 00:00:00 +0000 UTC'>November 11, 2025</span>&nbsp;Â·&nbsp;<span>fandengdong</span></footer>
  <a class="entry-link" aria-label="post link to å¼€å§‹ä½¿ç”¨ Mindspeed è¿›è¡Œå¤§æ¨¡å‹è®­ç»ƒ" href="http://localhost:1313/llm/mindspeed/get_started_with_mindspeed/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">MindspeedåŸºæœ¬ä»‹ç»
    </h2>
  </header>
  <div class="entry-content">
    <p>MindSpeedçš„æ ¸å¿ƒç›®çš„æ˜¯é«˜æ•ˆåœ°é€‚é…å’ŒåŠ é€ŸåŸºäºMegatron-LMçš„å¤§æ¨¡å‹ï¼Œä½¿å…¶èƒ½å¤Ÿåœ¨åä¸ºæ˜‡è…¾AIç¡¬ä»¶ä¸Šè¿›è¡Œè®­ç»ƒå’Œæ¨ç†ã€‚å…¶ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š
æ¡†æ¶å…¼å®¹æ€§ï¼šå°†åŸç”ŸMegatron-LMä»£ç é€‚é…åˆ°æ˜‡è…¾NPUæ¶æ„ï¼Œç¡®ä¿åŠŸèƒ½æ­£ç¡®æ€§ã€‚ æ€§èƒ½ä¼˜åŒ–ï¼šé€šè¿‡ç®—å­èåˆã€å†…å­˜ä¼˜åŒ–å’Œé€šä¿¡åŠ é€Ÿç­‰æŠ€æœ¯æå‡è®­ç»ƒå’Œæ¨ç†æ•ˆç‡ã€‚ å¤šçº§åŠ é€Ÿï¼šæä¾›å¯é…ç½®çš„ä¼˜åŒ–å±‚çº§ï¼ˆå¦‚åŸºç¡€å…¼å®¹æ€§ã€äº²å’Œæ€§å¢å¼ºã€å…¨é¢åŠ é€Ÿï¼‰ï¼Œç”¨æˆ·å¯æ ¹æ®éœ€æ±‚å¯ç”¨ã€‚ ç”Ÿæ€é›†æˆï¼šä¸CANNå’ŒMindSporeç­‰æ˜‡è…¾è½¯ä»¶æ ˆæ·±åº¦é›†æˆï¼Œå®ç°æ— ç¼çš„è½¯ç¡¬ä»¶ååŒä¼˜åŒ–ã€‚ ç®€è€Œè¨€ä¹‹ï¼ŒMindSpeedä½¿åŸºäºMegatronçš„å¤§æ¨¡å‹èƒ½å¤Ÿåœ¨æ˜‡è…¾è®¾å¤‡ä¸Šæ­£ç¡®è¿è¡Œã€å¿«é€Ÿè¿è¡Œå’Œå¯é è¿è¡Œã€‚
ä¸€è¡Œä»£ç é€‚é…Megatronä»£ç  import torch import mindspeed.megatron_adaptor # æ–°å¢ä»£ç è¡Œ åŠ é€Ÿç‰¹æ€§å±‚çº§è¯´æ˜ MindSpeed CoreåŠ é€Ÿç‰¹æ€§åˆ†ä¸ºä¸‰ä¸ªå±‚çº§ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡åœ¨å¯åŠ¨è„šæœ¬ä¸­è®¾ç½®--optimization-level {level}å‚æ•°æ¥æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©è¦å¯ç”¨çš„ä¼˜åŒ–çº§åˆ«ã€‚è¯¥å‚æ•°æ”¯æŒä»¥ä¸‹é…ç½®ï¼š
ç­‰çº§ ç­‰çº§åç§° æè¿° 0 åŸºç¡€åŠŸèƒ½å…¼å®¹æ€§ æä¾›Megatron-LMæ¡†æ¶ä¸NPUçš„åŸºç¡€åŠŸèƒ½å…¼å®¹æ€§ã€‚ 1 äº²å’Œæ€§å¢å¼º ğŸ”¥ åœ¨L0åŸºç¡€ä¸Šï¼Œå¯ç”¨éƒ¨åˆ†èåˆç®—å­å’Œæ˜‡è…¾å‹å¥½çš„è®¡ç®—é‡å†™ã€‚ 2 åŠ é€Ÿç‰¹æ€§å¢å¼º ğŸ”¥ğŸ”¥ é»˜è®¤å€¼ã€‚åœ¨L0å’ŒL1åŸºç¡€ä¸Šå¯ç”¨æ›´ä¸°å¯Œçš„åŠ é€Ÿç‰¹æ€§ï¼ŒåŠ é€Ÿç‰¹æ€§é€šå¸¸é€šè¿‡ç‰¹å®šå‚æ•°å¯ç”¨ã€‚è¯¦æƒ…è¯·å‚é˜…&#34;ç‰¹æ€§ä»‹ç»&#34;éƒ¨åˆ†ã€‚ MindSpeed Coreç”Ÿæ€ç³»ç»Ÿ åœ¨MindSpeed CoreåŠ é€Ÿåº“çš„åŸºç¡€ä¸Šï¼Œè¿˜æä¾›äº†ä»¥ä¸‹ä¸“ä¸šåº“ï¼š
å¤§è¯­è¨€æ¨¡å‹åº“: MindSpeed LLM å¤šæ¨¡æ€æ¨¡å‹åº“: MindSpeed MM å¼ºåŒ–å­¦ä¹ åŠ é€Ÿåº“: MindSpeed RL </p>
  </div>
  <footer class="entry-footer"><span title='2025-11-10 00:00:00 +0000 UTC'>November 10, 2025</span>&nbsp;Â·&nbsp;<span>fandengdong</span></footer>
  <a class="entry-link" aria-label="post link to MindspeedåŸºæœ¬ä»‹ç»" href="http://localhost:1313/llm/mindspeed/introduction_with_mindspeed/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Deploying vLLM in Production
    </h2>
  </header>
  <div class="entry-content">
    <p>Getting Started with vLLM Deployment Deploying large language models efficiently requires careful consideration of hardware resources and configuration parameters.
Installation Installing vLLM is straightforward using pip:
pip install vllm </p>
  </div>
  <footer class="entry-footer"><span title='2024-01-20 00:00:00 +0000 UTC'>January 20, 2024</span>&nbsp;Â·&nbsp;<span>fandengdong</span></footer>
  <a class="entry-link" aria-label="post link to Deploying vLLM in Production" href="http://localhost:1313/llm/vllm/deployment/"></a>
</article>
<footer class="page-footer">
  <nav class="pagination">
    <a class="next" href="http://localhost:1313/page/2/">Next&nbsp;&nbsp;Â»
    </a>
  </nav>
</footer>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">My work notes</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
